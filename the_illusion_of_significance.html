<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="The Cost of p-Values">

<title>The Illusion of Significance – Common Regression Issues</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-90617d54abb8d6c97f964c4c092f6cad.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="The Illusion of Significance – Common Regression Issues">
<meta property="og:description" content="The Cost of p-Values">
<meta property="og:image" content="https://redam94.github.io/common_regression_issues/02_the_illusion_of_significance_files/figure-html/fig-histogram-backward-selection-output-1.png">
<meta property="og:site_name" content="Common Regression Issues">
<meta property="og:image:height" content="728">
<meta property="og:image:width" content="1637">
<meta name="twitter:title" content="The Illusion of Significance – Common Regression Issues">
<meta name="twitter:description" content="The Cost of p-Values">
<meta name="twitter:image" content="https://redam94.github.io/common_regression_issues/02_the_illusion_of_significance_files/figure-html/fig-histogram-backward-selection-output-1.png">
<meta name="twitter:image-height" content="728">
<meta name="twitter:image-width" content="1637">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Common Regression Issues</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./the_illusion_of_significance.html">The Illusion of Significance</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Common Regression Issues</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sampling_error.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampling Error in Exogenous Variables</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multicollinearity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">When is Multicollinearity an Issue?</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./the_illusion_of_significance.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">The Illusion of Significance</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./trends_and_seasons.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Trends And Seasons</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./normalization_in_panel_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Centering in Panel Models</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">model_helpers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model_helpers/fourier_components.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fourier Components</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model_helpers/spline_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Splines</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">synthetic_data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./synthetic_data/simple_regression_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple Regression Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./synthetic_data/grouped_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Grouped Regression Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./synthetic_data/multicollinearity_example_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Generation for Demonstrating Multicollinearity</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">utils</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utils/plotting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Plotting Utils</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#from-illusion-to-insight-tldr" id="toc-from-illusion-to-insight-tldr" class="nav-link active" data-scroll-target="#from-illusion-to-insight-tldr">From Illusion to Insight — TLDR</a></li>
  <li><a href="#introduction-modeling-for-decision-making" id="toc-introduction-modeling-for-decision-making" class="nav-link" data-scroll-target="#introduction-modeling-for-decision-making">Introduction: Modeling for Decision Making</a>
  <ul class="collapse">
  <li><a href="#the-hidden-costs-of-misspecification-why-model-selection-matters" id="toc-the-hidden-costs-of-misspecification-why-model-selection-matters" class="nav-link" data-scroll-target="#the-hidden-costs-of-misspecification-why-model-selection-matters">The Hidden Costs of Misspecification: Why Model Selection Matters</a></li>
  <li><a href="#the-p-value-trap-why-significance-testing-misleads-model-selection" id="toc-the-p-value-trap-why-significance-testing-misleads-model-selection" class="nav-link" data-scroll-target="#the-p-value-trap-why-significance-testing-misleads-model-selection">The P-Value Trap: Why Significance Testing Misleads Model Selection</a></li>
  <li><a href="#when-statistical-illusions-drive-business-decisions" id="toc-when-statistical-illusions-drive-business-decisions" class="nav-link" data-scroll-target="#when-statistical-illusions-drive-business-decisions">When Statistical Illusions Drive Business Decisions</a></li>
  <li><a href="#the-reality-gap-when-exploratory-analysis-masquerades-as-causal-insight" id="toc-the-reality-gap-when-exploratory-analysis-masquerades-as-causal-insight" class="nav-link" data-scroll-target="#the-reality-gap-when-exploratory-analysis-masquerades-as-causal-insight">The Reality Gap: When Exploratory Analysis Masquerades as Causal Insight</a></li>
  </ul></li>
  <li><a href="#the-path-forward-getting-comfortable-with-uncertainty" id="toc-the-path-forward-getting-comfortable-with-uncertainty" class="nav-link" data-scroll-target="#the-path-forward-getting-comfortable-with-uncertainty">The Path Forward: Getting Comfortable with Uncertainty</a>
  <ul class="collapse">
  <li><a href="#the-uncertainty-laundering-machine" id="toc-the-uncertainty-laundering-machine" class="nav-link" data-scroll-target="#the-uncertainty-laundering-machine">The Uncertainty Laundering Machine</a></li>
  <li><a href="#the-mmm-value-mirage" id="toc-the-mmm-value-mirage" class="nav-link" data-scroll-target="#the-mmm-value-mirage">The MMM Value Mirage</a></li>
  <li><a href="#from-false-precision-to-honest-ignorance" id="toc-from-false-precision-to-honest-ignorance" class="nav-link" data-scroll-target="#from-false-precision-to-honest-ignorance">From False Precision to Honest Ignorance</a></li>
  <li><a href="#why-uncertainty-is-your-friend-not-your-enemy" id="toc-why-uncertainty-is-your-friend-not-your-enemy" class="nav-link" data-scroll-target="#why-uncertainty-is-your-friend-not-your-enemy">Why Uncertainty Is Your Friend, Not Your Enemy</a></li>
  <li><a href="#bayesian-methods-where-uncertainty-is-a-feature-not-a-bug" id="toc-bayesian-methods-where-uncertainty-is-a-feature-not-a-bug" class="nav-link" data-scroll-target="#bayesian-methods-where-uncertainty-is-a-feature-not-a-bug">Bayesian Methods: Where Uncertainty Is a Feature, Not a Bug</a></li>
  <li><a href="#practical-steps-toward-uncertainty-aware-mmm" id="toc-practical-steps-toward-uncertainty-aware-mmm" class="nav-link" data-scroll-target="#practical-steps-toward-uncertainty-aware-mmm">Practical Steps Toward Uncertainty-Aware MMM</a></li>
  <li><a href="#the-competitive-advantage-of-honest-uncertainty" id="toc-the-competitive-advantage-of-honest-uncertainty" class="nav-link" data-scroll-target="#the-competitive-advantage-of-honest-uncertainty">The Competitive Advantage of Honest Uncertainty</a></li>
  <li><a href="#a-new-standard-for-mmm-excellence" id="toc-a-new-standard-for-mmm-excellence" class="nav-link" data-scroll-target="#a-new-standard-for-mmm-excellence">A New Standard for MMM Excellence</a></li>
  </ul></li>
  <li><a href="#from-statistical-theater-to-decision-science-a-synthetic-case-study" id="toc-from-statistical-theater-to-decision-science-a-synthetic-case-study" class="nav-link" data-scroll-target="#from-statistical-theater-to-decision-science-a-synthetic-case-study">From Statistical Theater to Decision Science: A Synthetic Case Study</a>
  <ul class="collapse">
  <li><a href="#introduction-two-paradigms-two-futures" id="toc-introduction-two-paradigms-two-futures" class="nav-link" data-scroll-target="#introduction-two-paradigms-two-futures">Introduction: Two Paradigms, Two Futures</a></li>
  <li><a href="#the-business-context-and-data-generating-process" id="toc-the-business-context-and-data-generating-process" class="nav-link" data-scroll-target="#the-business-context-and-data-generating-process">1. The Business Context and Data Generating Process</a></li>
  <li><a href="#approach-a-the-frequentist-p-value-theater" id="toc-approach-a-the-frequentist-p-value-theater" class="nav-link" data-scroll-target="#approach-a-the-frequentist-p-value-theater">2. Approach A: The Frequentist P-Value Theater</a></li>
  </ul></li>
  <li><a href="#consequences-of-flawed-selection-in-mmm" id="toc-consequences-of-flawed-selection-in-mmm" class="nav-link" data-scroll-target="#consequences-of-flawed-selection-in-mmm">Consequences of Flawed Selection in MMM</a></li>
  <li><a href="#recommended-approaches-and-considerations" id="toc-recommended-approaches-and-considerations" class="nav-link" data-scroll-target="#recommended-approaches-and-considerations">Recommended Approaches and Considerations</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/redam94/common_regression_issues/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="the_illusion_of_significance.html.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The Illusion of Significance</h1>
</div>

<div>
  <div class="description">
    The Cost of p-Values
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Matthew Reda <a href="mailto:redam94@gmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
  </div>
    
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    <p>Statistical models drive millions in spending decisions, yet beneath their precise-looking numbers lurks a dangerous problem. This post examines how the practice of selecting variables based on p-values creates a statistical house of cards; especially in Marketing Mix Modeling (MMM) and budget optimization. I show why common techniques like stepwise regression inevitably produce overconfident models with biased estimates that violate the very statistical principles they claim to uphold. These methodological flaws can result in money flowing to the wrong marketing channels based on <strong>illusory</strong> performance metrics. I demonstrate why Bayesian approaches offer a more honest alternative by naturally tempering overconfidence, incorporating what we already know, and providing intuitive uncertainty measures. Through techniques like spike-and-slab priors (or regularized horseshoe priors) and Bayesian Model Averaging (BMA), analysts can move beyond arbitrary significance thresholds toward probability-based decision-making. While Bayesian methods do require more computational horsepower and thoughtful prior specification, modern software has made them increasingly accessible. Using simulated examples inspired by real-world marketing and economic modeling, I show how Bayesian methods produce more reliable insights that lead to smarter budget allocation decisions.</p>
  </div>
</div>


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="from-illusion-to-insight-tldr" class="level2">
<h2 class="anchored" data-anchor-id="from-illusion-to-insight-tldr">From Illusion to Insight — TLDR</h2>
<p>We’ve all seen it (perhaps even presented it); the perfectly constructed model with impressive-looking p-values that is used to justify adding millions in budget to a particular marketing channel. But how much can we really trust these insights? Statistical modeling approaches that rely on p-value thresholds (or <span class="math inline">\(\left| \text{t-stat}\right| &gt; 1\)</span>) for variable selection create a fundamental problem: the same data that builds the model also validates it, creating a circular logic that <strong>inevitably</strong> results in overconfidence. Methods like stepwise regression don’t just produce slightly inaccurate models: they systematically generate <strong>biased coefficients</strong>, <strong>invalid statistical tests</strong>, and <strong>unstable predictions</strong>. When these flawed models drive budget decisions, organizations end up misallocating resources based on what amounts to <strong>statistical mirages</strong> rather than <strong>genuine insights</strong>.</p>
<p>Bayesian statistics offers a more realistic alternative that acknowledges what traditional methods try to hide. <strong>Uncertainty is real!</strong> It should inform our decisions and not be artificially removed through statistical hocus-pocus for a slick deck. By treating parameters as variables with probability distributions and formally incorporating prior knowledge, Bayesian methods can help regularize models; prevent them from making wild claims the data can’t support. Techniques like spike-and-slab priors let us evaluate which variables truly matter without arbitrary cutoffs, while Bayesian Model Averaging sensibly hedges bets across multiple plausible models rather than on a single one. Though implementing Bayesian approaches does require more computational power, technical skill, and careful thought about prior assumptions, the payoff is substantial: <strong>more stable estimates</strong>, <strong>intuitive uncertainty measures</strong> that stakeholders can actually understand (seriously what is a confidence interval), and ultimately, budget allocation <strong>insights</strong> based on reality rather than <strong>statistical illusions</strong>.</p>
</section>
<section id="introduction-modeling-for-decision-making" class="level2">
<h2 class="anchored" data-anchor-id="introduction-modeling-for-decision-making">Introduction: Modeling for Decision Making</h2>
<section id="the-hidden-costs-of-misspecification-why-model-selection-matters" class="level3">
<h3 class="anchored" data-anchor-id="the-hidden-costs-of-misspecification-why-model-selection-matters">The Hidden Costs of Misspecification: Why Model Selection Matters</h3>
<p>Statistical models, particularly within econometrics and marketing analytics, serve as critical instruments for dissecting complex business phenomena and guiding strategic decisions. Marketing Mix Modeling (MMM) stands as a prime example. The insights derived from MMM are frequently used for two primary purposes: understanding the historical contribution of different marketing levers and, crucially, optimizing future budget allocations to maximize return on investment (ROI).</p>
<p>MMM’s use extends beyond prediction toward causal inference: understanding the “true”, incremental impact of altering a specific input, such as increasing social advertising spend, on the outcome variable (i.e.&nbsp;sales). This causal understanding is paramount for effective budget optimization.</p>
<p>However, standard modeling procedures, particularly those involving selection based on statistical significance, prioritize in-sample fit over robustness and causal validity. This focus inadvertently introduces substantial biases and instability. When models that systematically misrepresent causal effects guide budget decisions, organizations face significant resource misallocation that directly impacts profitability. The aggregated and time-series nature of marketing data further compounds these challenges, as weekly or monthly observations limit statistical power while still requiring controls for seasonality, economic trends, and competitive actions</p>
<p>As marketing analytics continues to drive increasingly larger investment decisions, the potential damage from flawed model specifications grows proportionally. This page examines how traditional variable selection approaches might generate misleading insights and offers a more robust Bayesian framework for addressing these methodological pitfalls.</p>
</section>
<section id="the-p-value-trap-why-significance-testing-misleads-model-selection" class="level3">
<h3 class="anchored" data-anchor-id="the-p-value-trap-why-significance-testing-misleads-model-selection">The P-Value Trap: Why Significance Testing Misleads Model Selection</h3>
<p>While p-values remain ubiquitous in statistical analysis, their application in model selection creates systematic distortions. The p-value measures the probability of observing data equally or more extreme than what was collected, assuming the null hypothesis holds true. Yet this metric becomes deeply problematic when used as a selection criterion.</p>
<p><strong>Critical misconceptions persist:</strong> Statistical significance doesn’t equate to practical importance. Large datasets can render trivial effects “significant,” while genuinely important relationships may fail arbitrary thresholds. When automated procedures like stepwise regression rely on p-values for variable selection, they introduce cascading failures:</p>
<section id="the-seven-deadly-sins-of-p-value-selection" class="level4">
<h4 class="anchored" data-anchor-id="the-seven-deadly-sins-of-p-value-selection">The Seven Deadly Sins of P-Value Selection</h4>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The math behind t-stats
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In the context of linear regression the test statistic for the i-th coefficient estimate is given as:</p>
<p><span class="math display">\[
\frac{\hat{\beta_i}}{\frac{\hat{\sigma}}{\sqrt{n\hat{\text{Var}}[X_i]}}\sqrt{VIF_i}}
\]</span></p>
<p>It’s clear from the mathematical description of the test statistic that:</p>
<ol type="1">
<li>Coefficients (<span class="math inline">\(\hat{\beta_i}\)</span>) with larger magnitudes — all else being equal — will be more “significant”.</li>
<li>Models with lower variance (<span class="math inline">\(\hat{\sigma}\)</span>) will lead to all coefficients being more “significant”.</li>
<li>Larger sample sizes (n) will increase all coefficients t-stat.</li>
<li>With increased variance in a predictor (<span class="math inline">\(\hat{\sigma}\)</span>) — all else being equal — that predictor will be more “significant”.</li>
<li>With increased correlation of covariate <span class="math inline">\(X_i\)</span> (<span class="math inline">\(VIF_i\)</span>) — all else being equal — that predictor will be less “significant”.</li>
</ol>
</div>
</div>
</div>
<p><strong>1. Systematized Cherry-Picking</strong><br>
Stepwise procedures systematically explore variable combinations until finding “significant” patterns. This automated search through analytical choices—different predictors, transformations, and specifications—guarantees finding patterns that appear meaningful but often reflect random noise. Even examining residuals to guide variable addition constitutes this problematic practice.</p>
<p><strong>2. The Multiplicity Trap</strong><br>
Testing numerous variables inflates false discovery rates exponentially. When evaluating 20 potential predictors, the chance of incorrectly declaring at least one significant approaches certainty. Standard software reports unadjusted p-values, hiding the true extent of multiple testing performed during selection.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Helper Functions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="cell-10" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> random_covariance(n_vars):</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create a random covariance matrix with a given correlation."""</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a random correlation matrix</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> np.random.randn(n_vars, n_vars)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    cov_matrix <span class="op">=</span> np.dot(A, A.T)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cov_matrix</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_data_no_signal(n_samples, n_vars, correlated<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create completely random data with no signal."""</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    mean <span class="op">=</span> np.zeros(n_vars)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> correlated:</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        cov <span class="op">=</span> random_covariance(n_signal_vars<span class="op">+</span>n_noise_vars)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        var <span class="op">=</span> np.diag(cov)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure var of variables is 1</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        cov <span class="op">=</span> cov <span class="op">/</span> np.sqrt(var[:, <span class="va">None</span>] <span class="op">*</span> var[<span class="va">None</span>, :])</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        cov <span class="op">=</span> np.eye(n_signal_vars<span class="op">+</span>n_noise_vars)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> np.random.multivariate_normal(</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        mean<span class="op">=</span>mean, </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        cov<span class="op">=</span>cov, </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        size<span class="op">=</span>n_samples</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> np.random.randn(n_samples)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(X), pd.Series(y)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_data_with_signal(</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    n_samples, </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    n_signal_vars, </span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    n_noise_vars, </span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    betas <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    correlated <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    noise_level<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create data with a signal in the first n_signal_vars."""</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    mean <span class="op">=</span> np.zeros(n_signal_vars<span class="op">+</span>n_noise_vars)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> correlated:</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        cov <span class="op">=</span> random_covariance(n_signal_vars<span class="op">+</span>n_noise_vars)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        var <span class="op">=</span> np.diag(cov)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure var of variables is 1</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        cov <span class="op">=</span> cov <span class="op">/</span> np.sqrt(var[:, <span class="va">None</span>] <span class="op">*</span> var[<span class="va">None</span>, :])</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>        cov <span class="op">=</span> np.eye(n_signal_vars<span class="op">+</span>n_noise_vars)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> np.random.multivariate_normal(</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        mean<span class="op">=</span>mean, </span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        cov<span class="op">=</span>cov,</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>        size<span class="op">=</span>n_samples)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> betas <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        betas <span class="op">=</span> np.zeros(n_signal_vars <span class="op">+</span> n_noise_vars)</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        betas[:n_signal_vars] <span class="op">=</span> np.random.randn(n_signal_vars)</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">len</span>(betas) <span class="op">==</span> n_signal_vars <span class="op">+</span> n_noise_vars, <span class="st">"betas must have the same length as the number of variables"</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a signal in the first n_signal_vars</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> np.dot(X, betas) <span class="op">+</span> np.random.randn(n_samples) <span class="op">*</span> noise_level <span class="op">*</span> np.var(np.dot(X, betas))</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(X), pd.Series(y), betas</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> forward_selection(</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    X: pd.DataFrame, y: pd.Series,</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    threshold_in<span class="op">=</span><span class="fl">0.05</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Perform forward selection with p-values to find the best subset of features."""</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize variables</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    n_features <span class="op">=</span> X.shape[<span class="dv">1</span>]</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    selected_features <span class="op">=</span> []</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    remaining_features <span class="op">=</span> <span class="bu">list</span>(X.columns)</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    np.random.shuffle(remaining_features) <span class="co"># Shuffle features to simulate repeated runs</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Perform forward selection with p-values</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> remaining_features:</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>        scores_with_candidates <span class="op">=</span> []</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> candidate <span class="kw">in</span> remaining_features:</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>            features <span class="op">=</span> selected_features <span class="op">+</span> [candidate]</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>            X_subset <span class="op">=</span> X.loc[:, features]</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> sm.OLS(y, sm.add_constant(X_subset)).fit()</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>            p_value <span class="op">=</span> model.pvalues[candidate]</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>            scores_with_candidates.append((p_value, candidate))</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Sort scores and select the best candidate</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>        scores_with_candidates.sort()</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>        best_new_score, best_candidate <span class="op">=</span> scores_with_candidates[<span class="dv">0</span>]</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> best_new_score <span class="op">&lt;</span> threshold_in:</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>            selected_features.append(best_candidate)</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>            remaining_features.remove(best_candidate)</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> selected_features</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> backward_selection(</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>    X: pd.DataFrame, y: pd.Series,</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>    threshold_out<span class="op">=</span><span class="fl">0.1</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Perform backward selection with p-values to find the best subset of features."""</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize variables</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>    selected_features <span class="op">=</span> <span class="bu">list</span>(X.columns)</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Perform backward selection with p-values</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> selected_features:</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>        features <span class="op">=</span> selected_features</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>        X_subset <span class="op">=</span> X.loc[:, features]</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> sm.OLS(y, sm.add_constant(X_subset)).fit()</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get the feature with the highest p-value</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>        p_values <span class="op">=</span> model.pvalues[<span class="dv">1</span>:]  <span class="co"># Exclude intercept</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>        max_p_value <span class="op">=</span> p_values.<span class="bu">max</span>()</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> max_p_value <span class="op">&gt;</span> threshold_out:</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>            feature_to_remove <span class="op">=</span> p_values.idxmax()</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>            selected_features.remove(feature_to_remove)</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> selected_features</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Simulate Variable Selection Based on P-Values
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="cell-13" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>n_trials <span class="op">=</span> <span class="dv">1_000</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>n_samples <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>n_signal_vars <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>n_noise_vars <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>X, y <span class="op">=</span> create_data_no_signal(</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    n_trials<span class="op">*</span>n_samples,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    n_signal_vars<span class="op">+</span>n_noise_vars, </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    correlated<span class="op">=</span><span class="va">False</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>X.columns <span class="op">=</span> [<span class="ss">f"X</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(X.shape[<span class="dv">1</span>])]</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>y.name <span class="op">=</span> <span class="st">"y"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-14" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>forward_selected_vars <span class="op">=</span> []</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trial <span class="kw">in</span> <span class="bu">range</span>(n_trials):</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    trial_df <span class="op">=</span> X.loc[trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>, :]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    trial_y <span class="op">=</span> y.loc[trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    forward_selected_vars.append(</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        forward_selection(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>            trial_df, </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>            trial_y, </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>            threshold_in<span class="op">=</span><span class="fl">0.05</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-15" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>backward_selected_vars <span class="op">=</span> []</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trial <span class="kw">in</span> <span class="bu">range</span>(n_trials):</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    trial_df <span class="op">=</span> X.loc[trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>, :]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    trial_y <span class="op">=</span> y.loc[trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    backward_selected_vars.append(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        backward_selection(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>            trial_df, </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>            trial_y, </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>            threshold_out<span class="op">=</span><span class="fl">0.05</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Backward Selection</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Foward Selection</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div id="cell-fig-histogram-backward-selection" class="cell">
<div class="cell-output cell-output-display">
<div id="fig-histogram-backward-selection" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-histogram-backward-selection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02_the_illusion_of_significance_files/figure-html/fig-histogram-backward-selection-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-histogram-backward-selection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Histogram of the number of selected variables in each trial using backward selection. The number of variables that are actually predictive are 0, however over 50% of the trials selected at least one variable as a statistically significant predictor.
</figcaption>
</figure>
</div>
</div>
</div>
<div id="cell-19" class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Family-wise error rate: 69.7%</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div id="cell-fig-histogram-forward-selection" class="cell">
<div class="cell-output cell-output-display">
<div id="fig-histogram-forward-selection" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-histogram-forward-selection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02_the_illusion_of_significance_files/figure-html/fig-histogram-forward-selection-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-histogram-forward-selection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Histogram of the number of selected variables in each trial using forward selection. The number of variables that are actually predictive are 0, however over 50% of the trials selected at least one variable as a statistically significant predictor.
</figcaption>
</figure>
</div>
</div>
</div>
<div id="cell-22" class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Family-wise error rate: 67.2%</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><strong>3. Chasing Ghosts in the Data</strong><br>
Selection procedures optimize for patterns specific to the training sample, capturing random fluctuations rather than stable relationships. This aggressive pursuit of in-sample fit produces models that fail catastrophically on new data.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Backward Selection</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Forward Selection</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Model Analysis
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="cell-27" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>SELECTION_METHOD <span class="op">=</span> backward_selected_vars</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>n_models_with_var <span class="op">=</span> {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    var: <span class="bu">sum</span>([var <span class="kw">in</span> selected <span class="cf">for</span> selected <span class="kw">in</span> SELECTION_METHOD])</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> var <span class="kw">in</span> X.columns</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>in_sample_models <span class="op">=</span> [</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    sm.OLS(</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        y.loc[i<span class="op">*</span>n_samples:(i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        sm.add_constant(X.loc[i<span class="op">*</span>n_samples:(i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>, selected])</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        ).fit() </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, selected <span class="kw">in</span> <span class="bu">enumerate</span>(SELECTION_METHOD)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>out_sample_model <span class="op">=</span> [</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    sm.OLS(</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        y.loc[<span class="op">~</span>i<span class="op">*</span>n_samples:(i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        sm.add_constant(X.loc[<span class="op">~</span>i<span class="op">*</span>n_samples:(i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>, selected])</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        ).fit()</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, selected <span class="kw">in</span> <span class="bu">enumerate</span>(SELECTION_METHOD)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>in_sample_r2 <span class="op">=</span> [model.rsquared <span class="cf">for</span> model <span class="kw">in</span> in_sample_models]</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>out_sample_r2 <span class="op">=</span> [model.rsquared <span class="cf">for</span> model <span class="kw">in</span> out_sample_model]</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> [</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    model.predict(sm.add_constant(X[selected])) </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> selected, model <span class="kw">in</span> <span class="bu">zip</span>(SELECTION_METHOD, in_sample_models)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>out_of_sample_mse <span class="op">=</span> [</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    np.mean((</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        y.loc[<span class="op">~</span>trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> pred[<span class="op">~</span>trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        )<span class="op">**</span><span class="dv">2</span>) </span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> trial, pred <span class="kw">in</span> <span class="bu">enumerate</span>(predictions)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>in_samples_mse <span class="op">=</span> [</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    np.mean((</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        y.loc[trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> pred[trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        )<span class="op">**</span><span class="dv">2</span>) </span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> trial, pred <span class="kw">in</span> <span class="bu">enumerate</span>(predictions)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div id="cell-fig-histogram-backward-selection-r2" class="cell">
<div class="cell-output cell-output-display">
<div id="fig-histogram-backward-selection-r2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-histogram-backward-selection-r2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02_the_illusion_of_significance_files/figure-html/fig-histogram-backward-selection-r2-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-histogram-backward-selection-r2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: In sample and out of sample R2 of the models selected using backward selection. The models are each trained on 100 samples and tested on the remaining samples. This demonstrates the overfitting of the models.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Model Analysis
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="cell-32" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>SELECTION_METHOD <span class="op">=</span> forward_selected_vars</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>n_models_with_var <span class="op">=</span> {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    var: <span class="bu">sum</span>([var <span class="kw">in</span> selected <span class="cf">for</span> selected <span class="kw">in</span> SELECTION_METHOD])</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> var <span class="kw">in</span> X.columns</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>in_sample_models <span class="op">=</span> [</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    sm.OLS(</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        y.loc[i<span class="op">*</span>n_samples:(i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        sm.add_constant(X.loc[i<span class="op">*</span>n_samples:(i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>, selected])</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        ).fit() </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, selected <span class="kw">in</span> <span class="bu">enumerate</span>(SELECTION_METHOD)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>out_sample_model <span class="op">=</span> [</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    sm.OLS(</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        y.loc[<span class="op">~</span>i<span class="op">*</span>n_samples:(i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        sm.add_constant(X.loc[<span class="op">~</span>i<span class="op">*</span>n_samples:(i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>, selected])</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        ).fit()</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, selected <span class="kw">in</span> <span class="bu">enumerate</span>(SELECTION_METHOD)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>in_sample_r2 <span class="op">=</span> [model.rsquared <span class="cf">for</span> model <span class="kw">in</span> in_sample_models]</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>out_sample_r2 <span class="op">=</span> [model.rsquared <span class="cf">for</span> model <span class="kw">in</span> out_sample_model]</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> [</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    model.predict(sm.add_constant(X[selected])) </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> selected, model <span class="kw">in</span> <span class="bu">zip</span>(SELECTION_METHOD, in_sample_models)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>out_of_sample_mse <span class="op">=</span> [</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    np.mean((</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        y.loc[<span class="op">~</span>trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> pred[<span class="op">~</span>trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>        )<span class="op">**</span><span class="dv">2</span>) </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> trial, pred <span class="kw">in</span> <span class="bu">enumerate</span>(predictions)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>in_samples_mse <span class="op">=</span> [</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    np.mean((</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>        y.loc[trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> pred[trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>        )<span class="op">**</span><span class="dv">2</span>) </span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> trial, pred <span class="kw">in</span> <span class="bu">enumerate</span>(predictions)</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div id="cell-fig-histogram-forward-selection-r2" class="cell">
<div class="cell-output cell-output-display">
<div id="fig-histogram-forward-selection-r2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-histogram-forward-selection-r2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02_the_illusion_of_significance_files/figure-html/fig-histogram-forward-selection-r2-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-histogram-forward-selection-r2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: In sample and out of sample R2 of the models selected using forward selection. The models are each trained on 100 samples and tested on the remaining samples. This demonstrates the overfitting of the models.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Simulation with Signal
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="cell-37" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>betas <span class="op">=</span> np.array([<span class="fl">.2</span>, <span class="fl">.1</span>, <span class="fl">.3</span>] <span class="op">+</span> [<span class="dv">0</span>]<span class="op">*</span>n_noise_vars)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>X_signal, y_signal, betas <span class="op">=</span> create_data_with_signal(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    n_trials<span class="op">*</span>n_samples,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    n_signal_vars, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    n_noise_vars, </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    correlated<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    betas<span class="op">=</span>betas, </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    noise_level<span class="op">=</span><span class="dv">3</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>X_signal.columns <span class="op">=</span> [<span class="ss">f"X</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(X_signal.shape[<span class="dv">1</span>])]</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>y_signal.name <span class="op">=</span> <span class="st">"y"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-38" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>forward_selected_signal_vars <span class="op">=</span> []</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trial <span class="kw">in</span> <span class="bu">range</span>(n_trials):</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    trial_df <span class="op">=</span> X_signal.loc[trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>, :]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    trial_y <span class="op">=</span> y_signal.loc[trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    forward_selected_signal_vars.append(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        forward_selection(</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>            trial_df, </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>            trial_y, </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>            threshold_in<span class="op">=</span><span class="fl">0.05</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-39" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>backward_selected_signal_vars <span class="op">=</span> []</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trial <span class="kw">in</span> <span class="bu">range</span>(n_trials):</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    trial_df <span class="op">=</span> X_signal.loc[trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>, :]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    trial_y <span class="op">=</span> y_signal.loc[trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    backward_selected_signal_vars.append(</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        backward_selection(</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>            trial_df, </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>            trial_y, </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>            threshold_out<span class="op">=</span><span class="fl">0.05</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Forward Selection</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Backward Selection</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Model Analysis
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="cell-43" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>SELECTION_METHOD <span class="op">=</span> forward_selected_signal_vars</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>in_sample_models <span class="op">=</span> [</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    sm.OLS(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        y_signal.loc[i<span class="op">*</span>n_samples:(i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        sm.add_constant(X_signal.loc[i<span class="op">*</span>n_samples:(i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>, selected])</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        ).fit() </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, selected <span class="kw">in</span> <span class="bu">enumerate</span>(SELECTION_METHOD)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>out_sample_model <span class="op">=</span> [</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    sm.OLS(</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        y_signal.loc[<span class="op">~</span>i<span class="op">*</span>n_samples:(i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        sm.add_constant(X_signal.loc[<span class="op">~</span>i<span class="op">*</span>n_samples:(i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>, selected])</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        ).fit()</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, selected <span class="kw">in</span> <span class="bu">enumerate</span>(SELECTION_METHOD)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>in_sample_r2 <span class="op">=</span> [model.rsquared <span class="cf">for</span> model <span class="kw">in</span> in_sample_models]</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>out_sample_r2 <span class="op">=</span> [model.rsquared <span class="cf">for</span> model <span class="kw">in</span> out_sample_model]</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> [</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    model.predict(sm.add_constant(X_signal[selected])) </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> selected, model <span class="kw">in</span> <span class="bu">zip</span>(SELECTION_METHOD, in_sample_models)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>out_of_sample_mse <span class="op">=</span> [</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    np.mean((</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>        y_signal.loc[<span class="op">~</span>trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> pred[<span class="op">~</span>trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>        )<span class="op">**</span><span class="dv">2</span>) </span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> trial, pred <span class="kw">in</span> <span class="bu">enumerate</span>(predictions)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>in_samples_mse <span class="op">=</span> [</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    np.mean((</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        y_signal.loc[trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> pred[trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>        )<span class="op">**</span><span class="dv">2</span>) </span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> trial, pred <span class="kw">in</span> <span class="bu">enumerate</span>(predictions)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div id="cell-fig-histogram-forward-selection-r2-signal" class="cell">
<div class="cell-output cell-output-display">
<div id="fig-histogram-forward-selection-r2-signal" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-histogram-forward-selection-r2-signal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02_the_illusion_of_significance_files/figure-html/fig-histogram-forward-selection-r2-signal-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-histogram-forward-selection-r2-signal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: In sample and out of sample R2 of the models selected using forward selection. The models are each trained on 100 samples and tested on the remaining samples. This demonstrates the overfitting of the models.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Model Analysis
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="cell-48" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>SELECTION_METHOD <span class="op">=</span> backward_selected_signal_vars</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>in_sample_models <span class="op">=</span> [</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    sm.OLS(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        y_signal.loc[i<span class="op">*</span>n_samples:(i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        sm.add_constant(X_signal.loc[i<span class="op">*</span>n_samples:(i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>, selected])</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        ).fit() </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, selected <span class="kw">in</span> <span class="bu">enumerate</span>(SELECTION_METHOD)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>out_sample_model <span class="op">=</span> [</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    sm.OLS(</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        y_signal.loc[<span class="op">~</span>i<span class="op">*</span>n_samples:(i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        sm.add_constant(X_signal.loc[<span class="op">~</span>i<span class="op">*</span>n_samples:(i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>, selected])</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        ).fit()</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, selected <span class="kw">in</span> <span class="bu">enumerate</span>(SELECTION_METHOD)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>in_sample_r2 <span class="op">=</span> [model.rsquared <span class="cf">for</span> model <span class="kw">in</span> in_sample_models]</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>out_sample_r2 <span class="op">=</span> [model.rsquared <span class="cf">for</span> model <span class="kw">in</span> out_sample_model]</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> [</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    model.predict(sm.add_constant(X_signal[selected])) </span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> selected, model <span class="kw">in</span> <span class="bu">zip</span>(SELECTION_METHOD, in_sample_models)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>out_of_sample_mse <span class="op">=</span> [</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    np.mean((</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        y_signal.loc[<span class="op">~</span>trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> pred[<span class="op">~</span>trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>        )<span class="op">**</span><span class="dv">2</span>) </span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> trial, pred <span class="kw">in</span> <span class="bu">enumerate</span>(predictions)</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>in_samples_mse <span class="op">=</span> [</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    np.mean((</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>        y_signal.loc[trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> pred[trial<span class="op">*</span>n_samples:(trial<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>n_samples<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>        )<span class="op">**</span><span class="dv">2</span>) </span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> trial, pred <span class="kw">in</span> <span class="bu">enumerate</span>(predictions)</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div id="cell-fig-histogram-backward-selection-r2-signal" class="cell">
<div class="cell-output cell-output-display">
<div id="fig-histogram-backward-selection-r2-signal" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-histogram-backward-selection-r2-signal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02_the_illusion_of_significance_files/figure-html/fig-histogram-backward-selection-r2-signal-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-histogram-backward-selection-r2-signal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: In sample and out of sample R2 of the models selected using backward selection. The models are each trained on 100 samples and tested on the remaining samples. This demonstrates the overfitting of the models.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p><strong>4. Systematic Bias in Effect Sizes</strong><br>
Selected variables exhibit inflated coefficients—not because they’re truly important, but because the selection process favors variables that randomly showed stronger associations. This “winner’s curse” systematically overstates the magnitude of selected effects.</p>
<div id="cell-fig-bias-induced-by-selection" class="cell">
<div class="cell-output cell-output-display">
<div id="fig-bias-induced-by-selection" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-bias-induced-by-selection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02_the_illusion_of_significance_files/figure-html/fig-bias-induced-by-selection-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bias-induced-by-selection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: The variable selection method systematically biases the coefficient estimates. This happens because models where the variable has a higher estimated effect are more likely to have that variable selected to be in the model. This is a form of selection bias.
</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>5. False Precision</strong><br>
Post-selection standard errors understate true uncertainty. Confidence intervals appear misleadingly narrow, and p-values seem artificially compelling. These metrics assume the model was pre-specified, not constructed through data exploration, rendering them fundamentally invalid.</p>
<div id="cell-55" class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Coverage of 95% confidence interval for X0: 85.3%
Coverage of 95% confidence interval for X1: 80.1%
Coverage of 95% confidence interval for X2: 83.1%</code></pre>
</div>
</div>
<p><strong>6. Fragile Foundations</strong><br>
Minor data perturbations can dramatically alter selected variables, especially with correlated predictors common in marketing data. Models that shift drastically with small changes provide unreliable foundations for business decisions.</p>
<div id="cell-57" class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Selection frequency of model Y ~ X0 + X1 + X2: 17.8%
Selection frequency of model Y ~ X0 + X2: 12.2%
Selection frequency of model Y ~ X0 + X2 + X18: 1.4%
Selection frequency of model Y ~ X0 + X2 + X22: 1.1%
Selection frequency of model Y ~ X0 + X2 + X5: 1.1%
Selection frequency of model Y ~ X0 + X1 + X2 + X21: 0.9%
Selection frequency of model Y ~ X0 + X2 + X15: 0.9%
Selection frequency of model Y ~ X0 + X1 + X2 + X15: 0.8%
Selection frequency of model Y ~ X0 + X1 + X2 + X19: 0.8%
Selection frequency of model Y ~ X0 + X2 + X4: 0.7%
Selection frequency of other models: 62.3%</code></pre>
</div>
</div>
<p><strong>7. Transformation Theater</strong><br>
Selecting functional forms (logarithmic, polynomial, adstock curves) based on significance compounds these problems. Testing hundreds of possible transformations virtually guarantees finding spurious patterns that optimize noise rather than signal.</p>
<p><strong>The fundamental flaw:</strong> Using the same data for both model construction and inference violates core statistical principles. When data drives model specification, subsequent p-values and confidence intervals lose their theoretical justification. The model becomes a product of exploration, not a hypothesis to test.</p>
</section>
</section>
<section id="when-statistical-illusions-drive-business-decisions" class="level3">
<h3 class="anchored" data-anchor-id="when-statistical-illusions-drive-business-decisions">When Statistical Illusions Drive Business Decisions</h3>
<p>The fundamental flaws in p-value driven selection cascade into real-world consequences that directly undermine business objectives. These aren’t merely theoretical concerns—they systematically distort our understanding of marketing effectiveness and lead to predictably poor outcomes.</p>
<p><strong>False Signals Masquerading as Insights</strong></p>
<p>Time-series data creates fertile ground for statistical mirages. When ice cream sales and drowning incidents both spike in summer, naive selection procedures eagerly identify “significant” relationships without recognizing the underlying seasonal driver. In MMM contexts, these spurious associations proliferate: variables that merely share trends or seasonal patterns get misidentified as meaningful predictors. Each false inclusion not only clutters the model but actively degrades our ability to estimate genuine marketing effects with precision.</p>
<p><strong>The Hidden Cost of Arbitrary Thresholds</strong></p>
<p>Significance cutoffs create a binary world where p = 0.049 means inclusion and p = 0.051 means exclusion—despite these values being functionally identical. This arbitrary boundary systematically excludes genuine causal factors that happen to fall just above the threshold in a particular sample. When these excluded variables correlate with included predictors, their omission biases every remaining coefficient. The model doesn’t just miss one relationship; it distorts all others.</p>
<p><strong>Causal Blindness in Automated Selection</strong></p>
<p>Statistical algorithms operate without causal awareness, unable to distinguish between fundamentally different types of relationships:</p>
<ul>
<li><strong>Confounders</strong> that must be included to block spurious associations</li>
<li><strong>Mediators</strong> whose inclusion obscures the total effects we seek to measure<br>
</li>
<li><strong>Colliders</strong> that create artificial associations when mistakenly conditioned upon</li>
</ul>
<p>Procedures that select variables based solely on statistical association routinely include variables that poison causal interpretation (mediators, colliders) while excluding those essential for valid inference (confounders). The resulting model becomes a causal minefield where coefficients represent unknown mixtures of direct effects, indirect pathways, and induced biases.</p>
<p><strong>The Analyst’s Dilemma: When Wrong Becomes Right</strong></p>
<p>Perhaps most insidiously, these flawed models create organizational inertia that perpetuates their errors. Analysts face immense pressure to ensure their updated models produce the same high-level conclusions as previous efforts—that TV drives 30% of sales, that digital ROI is 2.5x, that seasonality accounts for 15% of variance. This leads to a troubling pattern of behaviors:</p>
<ul>
<li><strong>Reverse Engineering Results:</strong> When new data suggests different attribution patterns, analysts manipulate model specifications until familiar conclusions emerge—adjusting adstock parameters, saturation curves, or control variables not for statistical validity but to reproduce expected ROI rankings</li>
<li><strong>Strategic Time Splitting:</strong> Models that attribute “too much” or “too little” to certain channels get subdivided into multiple time periods, fracturing the data until each segment yields the “correct” share of voice</li>
<li><strong>Selective Variable Inclusion:</strong> External factors get added or removed based on how they shift attribution between channels, using statistical significance as cover for what amounts to results manipulation</li>
<li><strong>Transformation Shopping:</strong> Analysts cycle through combinations of functional forms until the model produces ROI estimates and attribution percentages that align with organizational beliefs</li>
</ul>
<p>This creates a vicious cycle where each generation of models must reproduce not just any results, but the specific business conclusions that stakeholders have internalized. “TV should drive 25-35% of sales” becomes an unquestionable truth that models must confirm rather than test.</p>
<p><strong>From Flawed Models to Failed Strategies</strong></p>
<p>These statistical distortions translate directly into business failures. Biased coefficients paint a fantasy landscape of marketing effectiveness—some channels appear artificially powerful while others seem worthless or even harmful. Budget optimization based on these illusions inevitably fails: money flows to channels whose effectiveness was overstated while truly profitable opportunities starve for investment. The false confidence provided by inappropriately narrow confidence intervals compounds the damage, encouraging aggressive reallocation based on estimates that are both wrong and wrongly certain.</p>
<p><strong>The Reproducibility Crisis in Practice</strong></p>
<p>Models built on sample-specific quirks fail to generalize. When next quarter’s data arrives, the carefully selected variable set often produces wildly different results—or the selection procedure itself chooses entirely different variables. Rather than acknowledging this instability as evidence of flawed methodology, analysts scramble to manipulate the new model until it reproduces familiar attribution patterns and ROI hierarchies. This stability theater destroys organizational learning: teams spend more effort confirming past conclusions than discovering new truths. Strategic planning becomes impossible when the “insights” guiding it are actually fossilized artifacts of historical data mining.</p>
<p><strong>The compound effect is devastating:</strong> flawed statistical procedures produce unstable models with biased coefficients, which generate incorrect ROI estimates that become organizational “truth,” leading to poor budget allocation and ultimately reduced business performance. What begins as a methodological shortcut evolves into an institutional pathology where being consistently wrong becomes preferable to admitting uncertainty.</p>
</section>
<section id="the-reality-gap-when-exploratory-analysis-masquerades-as-causal-insight" class="level3">
<h3 class="anchored" data-anchor-id="the-reality-gap-when-exploratory-analysis-masquerades-as-causal-insight">The Reality Gap: When Exploratory Analysis Masquerades as Causal Insight</h3>
<p>Modern Marketing Mix Modeling exists in a troubling state of methodological confusion. Practitioners routinely present their models as <strong>predictive engines</strong> capable of forecasting future performance, while stakeholders interpret and apply these same models as <strong>causal instruments</strong> for optimizing budget allocation. The uncomfortable truth is that most MMM implementations are, at best, <strong>sophisticated exploratory analyses</strong> dressed up in the language of prediction and causation.</p>
<p>This disconnect between claims and capabilities creates a cascade of poor decisions. When exploratory models—built through p-value mining and post-hoc selection—are treated as causal truth, organizations systematically misallocate resources based on statistical mirages. The biased coefficients and overfitted relationships that emerge from flawed selection procedures don’t merely represent academic concerns; they translate directly into wasted marketing spend and missed opportunities.</p>
<p><strong>Perhaps most perniciously, these flawed models become the benchmarks against which new methodologies are evaluated.</strong> When a novel approach produces different results from traditional stepwise regression, it’s often dismissed as “inconsistent with established models” rather than recognized as potentially more accurate. This creates a self-reinforcing cycle where statistical illusions become institutionalized truths, and genuine improvements are rejected for failing to reproduce familiar biases.</p>
<p>The path forward requires honest acknowledgment of what current MMM practices actually deliver: exploratory insights that might suggest interesting patterns but cannot reliably predict future outcomes or identify causal relationships. Until the field adopts more rigorous methodologies—whether through Bayesian frameworks, proper regularization, or genuine causal inference techniques—we must stop pretending that models built on circular logic and data dredging can guide multi-million dollar decisions. <strong>The stakes are too high, and the methods too flawed, to continue conflating exploration with explanation.</strong></p>
</section>
</section>
<section id="the-path-forward-getting-comfortable-with-uncertainty" class="level2">
<h2 class="anchored" data-anchor-id="the-path-forward-getting-comfortable-with-uncertainty">The Path Forward: Getting Comfortable with Uncertainty</h2>
<section id="the-uncertainty-laundering-machine" class="level3">
<h3 class="anchored" data-anchor-id="the-uncertainty-laundering-machine">The Uncertainty Laundering Machine</h3>
<p>Statistician Andrew Gelman offers a devastating critique of how statistics is abused that perfectly captures the MMM crisis:</p>
<blockquote class="blockquote">
<p>“The ethics comes in if we think of this entire journal publication system as a sort of machine for laundering uncertainty: researchers start with junk data (for example, poorly-thought-out experiments on college students, or surveys of online Mechanical Turk participants) and then work with the data, straining out the null results and reporting what is statistically significant, in a process analogous to the notorious mortgage lenders of the mid-2000s, who created high-value ‘tranches’ out of subprime loans. The loan crisis precipitated an economic recession, and I doubt the replication crisis will trigger such a crash in science. But I see a crucial similarity in that technical methods (structured finance for mortgages; statistical significance for scientific research) were being used to create value out of thin air.”</p>
</blockquote>
<p>This analogy illuminates exactly what’s happening in MMM. We start with inherently uncertain, observational data—weekly sales figures confounded by countless factors, media spend that varies with business strategy, competitive actions we can’t fully observe. Then we run this “junk data” through our statistical machinery, straining out the non-significant variables, p-hacking our way to impressive results, and packaging the survivors as “insights.”</p>
<p><strong>Just as subprime mortgages got repackaged as AAA-rated securities, uncertain correlations get transformed into “proven” ROI figures.</strong> The technical sophistication of the process—the complex adstock transformations, the multi-stage regression models, the impressive p-values—serves the same function as the financial engineering of the 2000s: it launders uncertainty, creating an appearance of value and reliability that doesn’t actually exist.</p>
</section>
<section id="the-mmm-value-mirage" class="level3">
<h3 class="anchored" data-anchor-id="the-mmm-value-mirage">The MMM Value Mirage</h3>
<p>In marketing analytics, this laundering process follows a predictable pattern:</p>
<ol type="1">
<li><strong>Start with messy reality:</strong> Aggregated time series with ~200 observations, dozens of correlated variables, unobserved confounders</li>
<li><strong>Apply the machinery:</strong> Stepwise regression, transformation selection, significance testing</li>
<li><strong>Strain out uncertainty:</strong> Discard “non-significant” variables, ignore wide confidence intervals, suppress unstable results</li>
<li><strong>Package as certainty:</strong> “TV delivers 3.2x ROI (p &lt; 0.001)”</li>
</ol>
<p>The organization receives what appears to be valuable intelligence—precise ROI estimates, clear attribution percentages, “data-driven” recommendations. But like those mortgage-backed securities, the value is illusory. We’ve used technical methods to create certainty out of thin air.</p>
</section>
<section id="from-false-precision-to-honest-ignorance" class="level3">
<h3 class="anchored" data-anchor-id="from-false-precision-to-honest-ignorance">From False Precision to Honest Ignorance</h3>
<p>The marketing analytics industry has become addicted not just to certainty, but to this process of manufacturing it. Stakeholders demand precise ROI figures, and analysts have built an entire infrastructure—not to find truth, but to launder the fundamental uncertainty of marketing effectiveness into seemingly solid insights. The narrow confidence intervals and impressive p-values aren’t evidence of precision; they’re the output of a machine designed to hide uncertainty, not quantify it.</p>
<p><strong>The first step forward is dismantling the laundering machine.</strong> We must stop using statistical sophistication to obscure uncertainty and start using it for its proper purpose: to honestly quantify and communicate what we don’t know. Real marketing effects are messy, context-dependent, and riddled with uncertainty. Any methodology that claims otherwise is selling false comfort rather than actionable insight.</p>
</section>
<section id="why-uncertainty-is-your-friend-not-your-enemy" class="level3">
<h3 class="anchored" data-anchor-id="why-uncertainty-is-your-friend-not-your-enemy">Why Uncertainty Is Your Friend, Not Your Enemy</h3>
<p>Uncertainty isn’t a flaw to be hidden—it’s crucial information that should guide decision-making. Consider two scenarios:</p>
<ol type="1">
<li><strong>Traditional approach:</strong> “TV ROI is 3.2x”</li>
<li><strong>Honest approach:</strong> “TV ROI is likely between 1.5x and 5x, with our best estimate at 3x”</li>
</ol>
<p>The second statement contains more useful information. It acknowledges that TV might be marginally profitable or highly lucrative, suggesting a portfolio approach rather than an all-or-nothing strategy. The traditional approach’s false precision encourages overconfident bets based on point estimates that are likely wrong.</p>
<p><strong>Uncertainty quantification enables better decisions:</strong></p>
<ul>
<li><strong>Portfolio thinking:</strong> Wide credible intervals suggest diversification</li>
<li><strong>Experimentation priorities:</strong> High uncertainty indicates where tests would be most valuable</li>
<li><strong>Risk management:</strong> Understanding the range of possible outcomes prevents catastrophic misallocation</li>
<li><strong>Stakeholder trust:</strong> Acknowledging limitations builds more credibility than false precision</li>
</ul>
</section>
<section id="bayesian-methods-where-uncertainty-is-a-feature-not-a-bug" class="level3">
<h3 class="anchored" data-anchor-id="bayesian-methods-where-uncertainty-is-a-feature-not-a-bug">Bayesian Methods: Where Uncertainty Is a Feature, Not a Bug</h3>
<p>Bayesian approaches offer a natural framework for embracing uncertainty. Rather than producing single “best” models with spurious precision, Bayesian methods:</p>
<ul>
<li><strong>Quantify parameter uncertainty:</strong> Every coefficient comes with a full probability distribution, not just a point estimate</li>
<li><strong>Propagate uncertainty honestly:</strong> Uncertainty in parameters flows through to uncertainty in predictions and decisions</li>
<li><strong>Incorporate prior knowledge:</strong> Historical information and business constraints enter through priors, not through p-hacking</li>
<li><strong>Average over possibilities:</strong> Instead of selecting one model, Bayesian Model Averaging acknowledges multiple plausible realities</li>
</ul>
<p>When implemented properly, these methods produce results that might initially disappoint those seeking false precision: “Digital marketing ROI is probably positive (85% probability above 1.0x) with a median estimate of 1.8x and substantial uncertainty (90% credible interval: 0.7x to 4.2x).” Yet this honest assessment provides far more value than a precisely wrong point estimate.</p>
</section>
<section id="practical-steps-toward-uncertainty-aware-mmm" class="level3">
<h3 class="anchored" data-anchor-id="practical-steps-toward-uncertainty-aware-mmm">Practical Steps Toward Uncertainty-Aware MMM</h3>
<p><strong>1. Reframe the Conversation</strong></p>
<ul>
<li>Stop asking “What’s the exact ROI?” and start asking “What range of ROIs is plausible?”</li>
<li>Replace “Which model is correct?” with “What do multiple reasonable models suggest?”</li>
<li>Shift from “Prove this channel works” to “How confident are we about this channel’s effectiveness?”</li>
</ul>
<p><strong>2. Adopt Robust Methodologies</strong></p>
<ul>
<li>Implement regularization techniques that acknowledge coefficient uncertainty</li>
<li>Use Bayesian methods with thoughtful priors based on accumulated knowledge</li>
<li>Employ ensemble approaches that combine multiple models rather than selecting one</li>
<li>Validate through hold-out testing that honestly assesses predictive uncertainty</li>
</ul>
<p><strong>3. Visualize Uncertainty</strong></p>
<ul>
<li>Replace tables of point estimates with distributional plots</li>
<li>Show credible/confidence intervals prominently, not as footnotes</li>
<li>Use scenario planning based on uncertainty ranges</li>
<li>Create decision rules that explicitly account for uncertainty levels</li>
</ul>
<p><strong>4. Build Organizational Comfort</strong></p>
<ul>
<li>Educate stakeholders that uncertainty is information, not incompetence</li>
<li>Celebrate decisions that acknowledge and plan for uncertainty</li>
<li>Reward analysts who surface uncomfortable uncertainties over those who provide false comfort</li>
<li>Create processes that use uncertainty to guide experimentation priorities</li>
</ul>
</section>
<section id="the-competitive-advantage-of-honest-uncertainty" class="level3">
<h3 class="anchored" data-anchor-id="the-competitive-advantage-of-honest-uncertainty">The Competitive Advantage of Honest Uncertainty</h3>
<p>Organizations that embrace uncertainty gain a paradoxical advantage: by admitting what they don’t know, they make better decisions than competitors clinging to false precision. They:</p>
<ul>
<li><strong>Avoid catastrophic bets</strong> based on spuriously precise estimates</li>
<li><strong>Identify genuine opportunities</strong> that uncertainty-averse competitors miss</li>
<li><strong>Build resilient strategies</strong> that perform well across plausible scenarios</li>
<li><strong>Learn faster</strong> by focusing experimentation where uncertainty is highest</li>
<li><strong>Adapt more quickly</strong> when reality diverges from estimates</li>
</ul>
</section>
<section id="a-new-standard-for-mmm-excellence" class="level3">
<h3 class="anchored" data-anchor-id="a-new-standard-for-mmm-excellence">A New Standard for MMM Excellence</h3>
<p>The future of marketing analytics lies not in ever-more-sophisticated methods for manufacturing certainty, but in frameworks that honestly quantify and communicate what we don’t know. Excellence should be measured not by how narrow our confidence intervals are, but by how well our uncertainty estimates reflect reality.</p>
<p>This requires a fundamental shift: from viewing uncertainty as a problem to solve, to recognizing it as essential information for decision-making. Only by getting comfortable with uncertainty can we move beyond the statistical theater that currently dominates MMM and toward methods that genuinely improve marketing effectiveness.</p>
<p><strong>The path forward is clear:</strong> Embrace uncertainty, quantify it honestly, and use it to make more robust decisions. The alternative—continuing to pretend we know more than we do—has already proven its capacity for expensive failure.</p>
</section>
</section>
<section id="from-statistical-theater-to-decision-science-a-synthetic-case-study" class="level2">
<h2 class="anchored" data-anchor-id="from-statistical-theater-to-decision-science-a-synthetic-case-study">From Statistical Theater to Decision Science: A Synthetic Case Study</h2>
<section id="introduction-two-paradigms-two-futures" class="level3">
<h3 class="anchored" data-anchor-id="introduction-two-paradigms-two-futures">Introduction: Two Paradigms, Two Futures</h3>
<p>To illustrate the stark contrast between current practices and what’s possible, we present a synthetic case study of a hypothetical consumer brand allocating $50 million across marketing channels. We’ll analyze the same dataset through two fundamentally different lenses:</p>
<p><strong>The Status Quo:</strong> A traditional frequentist approach that relies on stepwise selection, p-value thresholds, and point estimates—the statistical laundering machine in action.</p>
<p><strong>The Alternative:</strong> A Bayesian causal framework that explicitly models uncertainty, incorporates domain knowledge, and acknowledges multiple plausible realities—an honest attempt to support decision-making under uncertainty.</p>
<p>This isn’t merely an academic exercise. The differences in these approaches translate directly into millions of dollars in marketing effectiveness. One path leads to overconfident bets based on statistical mirages; the other to robust strategies that perform well across the range of plausible truths. The following analysis demonstrates not just why change is necessary, but what that change looks like in practice.</p>
</section>
<section id="the-business-context-and-data-generating-process" class="level3">
<h3 class="anchored" data-anchor-id="the-business-context-and-data-generating-process">1. The Business Context and Data Generating Process</h3>
<ul>
<li>Company background and marketing challenge</li>
<li>True underlying causal structure (hidden from analysts)</li>
<li>Simulated data generation with realistic confounders</li>
<li>Observable variables vs.&nbsp;latent factors</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Synthetic Data Generation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="cell-66" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hill_transformation(x, alpha<span class="op">=</span><span class="dv">1</span>, k<span class="op">=</span><span class="fl">0.5</span>):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Hill saturation transformation</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">    x: media spend (scaled 0-1)</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">    alpha: shape parameter (&lt;=1 for c-shaped curve, &gt;1 for s-shaped)</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">    k: half-saturation point</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x<span class="op">**</span>alpha <span class="op">/</span> (x<span class="op">**</span>alpha <span class="op">+</span> k<span class="op">**</span>alpha)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> model_simulate(</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    X: pd.DataFrame,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    coeffs_main: pd.Series,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    intercept: <span class="bu">float</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    alphas: pd.Series,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    k_values: pd.Series,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    media_maxes: pd.Series,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    noise_level: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    random_seed: <span class="bu">int</span> <span class="op">=</span> <span class="dv">42</span>,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    np.random.seed(random_seed)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> X.copy()</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    media_vars <span class="op">=</span> <span class="bu">list</span>(alphas.index)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    X_scaled <span class="op">=</span> X[media_vars] <span class="op">/</span> (media_maxes <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> media_var <span class="kw">in</span> media_vars:</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>        X[media_var] <span class="op">=</span> hill_transformation(X_scaled[media_var], alpha<span class="op">=</span>alphas[media_var], k<span class="op">=</span>k_values[media_var])</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    contribution <span class="op">=</span> X<span class="op">*</span>coeffs_main</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    y_mean <span class="op">=</span> X.dot(coeffs_main) <span class="op">+</span> intercept</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    y_sample <span class="op">=</span> y_mean <span class="op">+</span> np.random.normal(<span class="dv">0</span>, noise_level, size<span class="op">=</span><span class="bu">len</span>(y_mean))</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X, y_mean, contribution, y_sample</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_synthetic_mmm_data(</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    n_weeks<span class="op">=</span><span class="dv">156</span>, </span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    n_media<span class="op">=</span><span class="dv">5</span>, </span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>    random_seed<span class="op">=</span><span class="dv">42</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    ):</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a><span class="co">    Generate realistic MMM data with complex causal structure including mediator, confounders and colliders</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="co">    n_weeks: 3 years of weekly data</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>    np.random.seed(random_seed)</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Time index</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> np.arange(n_weeks)</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ========================================</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CONFOUNDERS (affect both media spend and sales)</span></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ========================================</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. Seasonality - drives both promotional activity and natural sales patterns</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>    seasonality <span class="op">=</span> <span class="fl">0.3</span> <span class="op">*</span> np.sin(<span class="dv">2</span> <span class="op">*</span> np.pi <span class="op">*</span> t <span class="op">/</span> <span class="dv">52</span>) <span class="op">+</span> <span class="fl">0.1</span> <span class="op">*</span> np.sin(<span class="dv">4</span> <span class="op">*</span> np.pi <span class="op">*</span> t <span class="op">/</span> <span class="dv">52</span>)</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. Macroeconomic conditions - affects marketing budgets and consumer spending</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>    gdp_growth <span class="op">=</span> <span class="fl">0.02</span> <span class="op">+</span> <span class="fl">0.01</span> <span class="op">*</span> np.sin(<span class="dv">2</span> <span class="op">*</span> np.pi <span class="op">*</span> t <span class="op">/</span> <span class="dv">104</span>) <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="dv">1</span>, n_weeks).cumsum() <span class="op">/</span> n_weeks</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>    unemployment <span class="op">=</span> <span class="fl">5.0</span> <span class="op">+</span> <span class="fl">2.0</span> <span class="op">*</span> np.sin(<span class="dv">2</span> <span class="op">*</span> np.pi <span class="op">*</span> t <span class="op">/</span> <span class="dv">156</span> <span class="op">+</span> <span class="fl">1.5</span>) <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.2</span>, n_weeks)</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>    consumer_confidence <span class="op">=</span> <span class="dv">100</span> <span class="op">+</span> <span class="dv">10</span> <span class="op">*</span> gdp_growth <span class="op">*</span> <span class="dv">10</span> <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> unemployment <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="dv">3</span>, n_weeks)</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. Major retail events - drive both promotional spend and sales</span></span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>    holidays <span class="op">=</span> np.zeros(n_weeks)</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>    black_friday <span class="op">=</span> [(w <span class="op">%</span> <span class="dv">52</span> <span class="op">==</span> <span class="dv">47</span>) <span class="cf">for</span> w <span class="kw">in</span> <span class="bu">range</span>(n_weeks)]</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>    christmas <span class="op">=</span> [(w <span class="op">%</span> <span class="dv">52</span> <span class="op">&gt;=</span> <span class="dv">50</span>) <span class="kw">or</span> (w <span class="op">%</span> <span class="dv">52</span> <span class="op">&lt;=</span> <span class="dv">1</span>) <span class="cf">for</span> w <span class="kw">in</span> <span class="bu">range</span>(n_weeks)]</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>    holidays[black_friday] <span class="op">=</span> <span class="fl">1.5</span></span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>    holidays[christmas] <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. Competitor promotional intensity - triggers reactive spending and affects sales</span></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>    competitor_promos <span class="op">=</span> <span class="fl">0.3</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> np.sin(<span class="dv">2</span> <span class="op">*</span> np.pi <span class="op">*</span> t <span class="op">/</span> <span class="dv">13</span>) <span class="op">+</span> <span class="fl">0.1</span> <span class="op">*</span> np.random.randn(n_weeks).cumsum() <span class="op">/</span> n_weeks</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>    competitor_promos <span class="op">=</span> np.clip(competitor_promos, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 5. Product lifecycle stage - affects marketing strategy and natural demand</span></span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>    product_age <span class="op">=</span> t <span class="op">/</span> <span class="dv">52</span>  <span class="co"># Years since launch</span></span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>    product_lifecycle <span class="op">=</span> np.exp(<span class="op">-</span>product_age <span class="op">/</span> <span class="dv">2</span>) <span class="op">*</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.5</span>  <span class="co"># Decaying newness effect</span></span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ========================================</span></span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># SALES DRIVERS (affect sales but NOT media spend)</span></span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ========================================</span></span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. Distribution gains - more stores carrying product</span></span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>    distribution_points <span class="op">=</span> <span class="dv">1000</span> <span class="op">+</span> <span class="dv">10</span> <span class="op">*</span> t <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="dv">20</span>, n_weeks).cumsum()</span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>    distribution_index <span class="op">=</span> distribution_points <span class="op">/</span> distribution_points[<span class="dv">0</span>]</span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. Product quality improvements (e.g., ratings)</span></span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>    quality_score <span class="op">=</span> <span class="fl">4.0</span> <span class="op">+</span> <span class="fl">0.02</span> <span class="op">*</span> t <span class="op">/</span> n_weeks <span class="op">+</span> <span class="fl">0.1</span> <span class="op">*</span> np.random.randn(n_weeks).cumsum() <span class="op">/</span> n_weeks</span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>    quality_score <span class="op">=</span> np.clip(quality_score, <span class="fl">3.5</span>, <span class="fl">5.0</span>)</span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. Word of mouth momentum (builds over time, not marketing driven)</span></span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>    wom_momentum <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> np.exp(<span class="op">-</span>t <span class="op">/</span> <span class="dv">26</span>)) <span class="op">+</span> <span class="fl">0.05</span> <span class="op">*</span> np.random.randn(n_weeks).cumsum() <span class="op">/</span> n_weeks</span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>    wom_momentum <span class="op">=</span> np.clip(wom_momentum, <span class="dv">0</span>, <span class="fl">0.3</span>)</span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ========================================</span></span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RED HERRINGS (correlated but don't affect sales)</span></span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ========================================</span></span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. Weather patterns (correlate with seasonality but don't drive sales)</span></span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a>    temperature <span class="op">=</span> <span class="dv">60</span> <span class="op">+</span> <span class="dv">25</span> <span class="op">*</span> np.sin(<span class="dv">2</span> <span class="op">*</span> np.pi <span class="op">*</span> t <span class="op">/</span> <span class="dv">52</span>) <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="dv">7</span>, n_weeks)</span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a>    precipitation <span class="op">=</span> <span class="dv">2</span> <span class="op">+</span> <span class="fl">1.5</span> <span class="op">*</span> np.sin(<span class="dv">2</span> <span class="op">*</span> np.pi <span class="op">*</span> t <span class="op">/</span> <span class="dv">52</span> <span class="op">+</span> <span class="dv">3</span>) <span class="op">+</span> np.<span class="bu">abs</span>(np.random.normal(<span class="dv">0</span>, <span class="fl">0.5</span>, n_weeks))</span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. Stock market index (correlates with economy but doesn't directly drive sales)</span></span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a>    stock_index <span class="op">=</span> <span class="dv">10000</span> <span class="op">+</span> <span class="dv">50</span> <span class="op">*</span> t <span class="op">+</span> <span class="dv">500</span> <span class="op">*</span> gdp_growth.cumsum() <span class="op">+</span> <span class="dv">200</span> <span class="op">*</span> np.random.randn(n_weeks).cumsum()</span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. Social media followers (grows over time but doesn't drive sales)</span></span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a>    social_followers <span class="op">=</span> <span class="dv">10000</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> <span class="fl">0.02</span> <span class="op">*</span> t <span class="op">+</span> <span class="fl">0.1</span> <span class="op">*</span> np.random.randn(n_weeks).cumsum() <span class="op">/</span> n_weeks)</span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a>    social_followers <span class="op">=</span> np.maximum(social_followers, <span class="dv">10000</span>)</span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. Website traffic (correlates with media but doesn't independently drive sales)</span></span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a>    base_traffic <span class="op">=</span> <span class="dv">50000</span> <span class="op">+</span> <span class="dv">500</span> <span class="op">*</span> t</span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 5. Number of SKUs (correlates with time but doesn't affect aggregate sales)</span></span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a>    num_skus <span class="op">=</span> <span class="dv">10</span> <span class="op">+</span> np.floor(t <span class="op">/</span> <span class="dv">26</span>) <span class="op">+</span> np.random.binomial(<span class="dv">2</span>, <span class="fl">0.1</span>, n_weeks).cumsum()</span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ========================================</span></span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># MEDIA SPEND GENERATION</span></span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ========================================</span></span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-116"><a href="#cb16-116" aria-hidden="true" tabindex="-1"></a>    media_names <span class="op">=</span> [<span class="st">'TV'</span>, <span class="st">'Digital'</span>, <span class="st">'Social'</span>, <span class="st">'Radio'</span>, <span class="st">'Print'</span>]</span>
<span id="cb16-117"><a href="#cb16-117" aria-hidden="true" tabindex="-1"></a>    media_spend_raw <span class="op">=</span> np.zeros((n_weeks, n_media))</span>
<span id="cb16-118"><a href="#cb16-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-119"><a href="#cb16-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Budget influenced by confounders</span></span>
<span id="cb16-120"><a href="#cb16-120" aria-hidden="true" tabindex="-1"></a>    total_budget_index <span class="op">=</span> (<span class="fl">1.0</span> <span class="op">+</span> </span>
<span id="cb16-121"><a href="#cb16-121" aria-hidden="true" tabindex="-1"></a>                         <span class="fl">0.2</span> <span class="op">*</span> consumer_confidence <span class="op">/</span> <span class="dv">100</span> <span class="op">+</span> </span>
<span id="cb16-122"><a href="#cb16-122" aria-hidden="true" tabindex="-1"></a>                         <span class="fl">0.6</span> <span class="op">*</span> holidays <span class="op">+</span> </span>
<span id="cb16-123"><a href="#cb16-123" aria-hidden="true" tabindex="-1"></a>                         <span class="fl">0.4</span> <span class="op">*</span> product_lifecycle <span class="op">-</span> </span>
<span id="cb16-124"><a href="#cb16-124" aria-hidden="true" tabindex="-1"></a>                         <span class="fl">0.15</span> <span class="op">*</span> competitor_promos)</span>
<span id="cb16-125"><a href="#cb16-125" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-126"><a href="#cb16-126" aria-hidden="true" tabindex="-1"></a>    <span class="co"># TV: Traditional, holiday-focused, reactive to competition</span></span>
<span id="cb16-127"><a href="#cb16-127" aria-hidden="true" tabindex="-1"></a>    media_spend_raw[:, <span class="dv">0</span>] <span class="op">=</span> (<span class="dv">200000</span> <span class="op">*</span> (total_budget_index <span class="op">*</span></span>
<span id="cb16-128"><a href="#cb16-128" aria-hidden="true" tabindex="-1"></a>                            (<span class="fl">0.4</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> holidays <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> seasonality <span class="op">-</span> <span class="fl">0.1</span> <span class="op">*</span> competitor_promos)) <span class="op">*</span></span>
<span id="cb16-129"><a href="#cb16-129" aria-hidden="true" tabindex="-1"></a>                            (<span class="dv">1</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> np.random.randn(n_weeks)))</span>
<span id="cb16-130"><a href="#cb16-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-131"><a href="#cb16-131" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Digital: Growing trend, responsive to GDP</span></span>
<span id="cb16-132"><a href="#cb16-132" aria-hidden="true" tabindex="-1"></a>    media_spend_raw[:, <span class="dv">1</span>] <span class="op">=</span> (<span class="dv">150000</span> <span class="op">*</span> (total_budget_index <span class="op">*</span></span>
<span id="cb16-133"><a href="#cb16-133" aria-hidden="true" tabindex="-1"></a>                            (<span class="fl">0.3</span> <span class="op">+</span> <span class="fl">0.05</span> <span class="op">*</span> t <span class="op">/</span> n_weeks <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> gdp_growth <span class="op">*</span> <span class="dv">10</span>)) <span class="op">*</span></span>
<span id="cb16-134"><a href="#cb16-134" aria-hidden="true" tabindex="-1"></a>                            (<span class="dv">1</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> np.random.randn(n_weeks)))</span>
<span id="cb16-135"><a href="#cb16-135" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-136"><a href="#cb16-136" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Social: Volatile, product-launch focused</span></span>
<span id="cb16-137"><a href="#cb16-137" aria-hidden="true" tabindex="-1"></a>    media_spend_raw[:, <span class="dv">2</span>] <span class="op">=</span> (<span class="dv">80000</span> <span class="op">*</span> (total_budget_index <span class="op">*</span> </span>
<span id="cb16-138"><a href="#cb16-138" aria-hidden="true" tabindex="-1"></a>                            (<span class="fl">0.2</span> <span class="op">+</span> <span class="fl">0.4</span> <span class="op">*</span> product_lifecycle <span class="op">-</span> <span class="fl">0.2</span> <span class="op">*</span> holidays)) <span class="op">*</span></span>
<span id="cb16-139"><a href="#cb16-139" aria-hidden="true" tabindex="-1"></a>                            (<span class="dv">1</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> np.random.randn(n_weeks)))</span>
<span id="cb16-140"><a href="#cb16-140" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-141"><a href="#cb16-141" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Radio: Steady with seasonal pattern</span></span>
<span id="cb16-142"><a href="#cb16-142" aria-hidden="true" tabindex="-1"></a>    media_spend_raw[:, <span class="dv">3</span>] <span class="op">=</span> (<span class="dv">50000</span> <span class="op">*</span> (total_budget_index <span class="op">*</span></span>
<span id="cb16-143"><a href="#cb16-143" aria-hidden="true" tabindex="-1"></a>                            <span class="fl">0.3</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> seasonality) <span class="op">*</span></span>
<span id="cb16-144"><a href="#cb16-144" aria-hidden="true" tabindex="-1"></a>                            (<span class="dv">1</span> <span class="op">+</span> <span class="fl">0.4</span> <span class="op">*</span> np.random.randn(n_weeks)))</span>
<span id="cb16-145"><a href="#cb16-145" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-146"><a href="#cb16-146" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print: Declining trend, older demographic</span></span>
<span id="cb16-147"><a href="#cb16-147" aria-hidden="true" tabindex="-1"></a>    media_spend_raw[:, <span class="dv">4</span>] <span class="op">=</span> (<span class="dv">40000</span> <span class="op">*</span> total_budget_index <span class="op">*</span> </span>
<span id="cb16-148"><a href="#cb16-148" aria-hidden="true" tabindex="-1"></a>                            (<span class="fl">0.4</span> <span class="op">-</span> <span class="fl">0.1</span> <span class="op">*</span> t <span class="op">/</span> n_weeks) <span class="op">*</span></span>
<span id="cb16-149"><a href="#cb16-149" aria-hidden="true" tabindex="-1"></a>                            (<span class="dv">1</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> np.random.randn(n_weeks)))</span>
<span id="cb16-150"><a href="#cb16-150" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-151"><a href="#cb16-151" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure non-negative</span></span>
<span id="cb16-152"><a href="#cb16-152" aria-hidden="true" tabindex="-1"></a>    media_spend_raw <span class="op">=</span> np.maximum(media_spend_raw, <span class="dv">0</span>)</span>
<span id="cb16-153"><a href="#cb16-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-154"><a href="#cb16-154" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Scale and transform</span></span>
<span id="cb16-155"><a href="#cb16-155" aria-hidden="true" tabindex="-1"></a>    media_spend_scaled <span class="op">=</span> media_spend_raw <span class="op">/</span> (media_spend_raw.<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">0</span>) <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb16-156"><a href="#cb16-156" aria-hidden="true" tabindex="-1"></a>    media_transformed <span class="op">=</span> np.zeros_like(media_spend_scaled)</span>
<span id="cb16-157"><a href="#cb16-157" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-158"><a href="#cb16-158" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Different saturation parameters by channel</span></span>
<span id="cb16-159"><a href="#cb16-159" aria-hidden="true" tabindex="-1"></a>    alphas <span class="op">=</span> [<span class="fl">1.0</span>, <span class="fl">2.0</span>, <span class="fl">1.4</span>, <span class="fl">1.0</span>, <span class="fl">1.2</span>]</span>
<span id="cb16-160"><a href="#cb16-160" aria-hidden="true" tabindex="-1"></a>    k_values <span class="op">=</span> [<span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.35</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>]</span>
<span id="cb16-161"><a href="#cb16-161" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-162"><a href="#cb16-162" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_media):</span>
<span id="cb16-163"><a href="#cb16-163" aria-hidden="true" tabindex="-1"></a>        media_transformed[:, i] <span class="op">=</span> hill_transformation(media_spend_scaled[:, i], alphas[i], k_values[i])</span>
<span id="cb16-164"><a href="#cb16-164" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-165"><a href="#cb16-165" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update website traffic based on digital spend (red herring - correlates but doesn't cause sales)</span></span>
<span id="cb16-166"><a href="#cb16-166" aria-hidden="true" tabindex="-1"></a>    website_traffic <span class="op">=</span> base_traffic <span class="op">+</span> <span class="dv">1000</span> <span class="op">*</span> media_transformed[:, <span class="dv">1</span>] <span class="op">+</span> <span class="dv">500</span> <span class="op">*</span> media_transformed[:, <span class="dv">2</span>]</span>
<span id="cb16-167"><a href="#cb16-167" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-168"><a href="#cb16-168" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ========================================</span></span>
<span id="cb16-169"><a href="#cb16-169" aria-hidden="true" tabindex="-1"></a>    <span class="co"># MEDIATOR VARIABLE (Media → Purchase Intent → Sales)</span></span>
<span id="cb16-170"><a href="#cb16-170" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ========================================</span></span>
<span id="cb16-171"><a href="#cb16-171" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-172"><a href="#cb16-172" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Purchase intent is driven by media spend (especially TV and Digital)</span></span>
<span id="cb16-173"><a href="#cb16-173" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This represents the percentage of consumers intending to purchase</span></span>
<span id="cb16-174"><a href="#cb16-174" aria-hidden="true" tabindex="-1"></a>    purchase_intent_base <span class="op">=</span> <span class="fl">0.15</span>  <span class="co"># 15% base intent</span></span>
<span id="cb16-175"><a href="#cb16-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-176"><a href="#cb16-176" aria-hidden="true" tabindex="-1"></a>    indirect_media_effects <span class="op">=</span> np.array([<span class="fl">0.12</span>, <span class="fl">0.10</span>, <span class="fl">0.08</span>, <span class="fl">0.04</span>, <span class="fl">0.02</span>])  <span class="co"># Indirect media effects on intent</span></span>
<span id="cb16-177"><a href="#cb16-177" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Media drives purchase intent</span></span>
<span id="cb16-178"><a href="#cb16-178" aria-hidden="true" tabindex="-1"></a>    purchase_intent <span class="op">=</span> (purchase_intent_base <span class="op">+</span></span>
<span id="cb16-179"><a href="#cb16-179" aria-hidden="true" tabindex="-1"></a>                      <span class="fl">0.12</span> <span class="op">*</span> media_transformed[:, <span class="dv">0</span>] <span class="op">+</span>    <span class="co"># TV has strong effect on intent</span></span>
<span id="cb16-180"><a href="#cb16-180" aria-hidden="true" tabindex="-1"></a>                      <span class="fl">0.10</span> <span class="op">*</span> media_transformed[:, <span class="dv">1</span>] <span class="op">+</span>    <span class="co"># Digital also drives intent</span></span>
<span id="cb16-181"><a href="#cb16-181" aria-hidden="true" tabindex="-1"></a>                      <span class="fl">0.08</span> <span class="op">*</span> media_transformed[:, <span class="dv">2</span>] <span class="op">+</span>    <span class="co"># Social moderate effect</span></span>
<span id="cb16-182"><a href="#cb16-182" aria-hidden="true" tabindex="-1"></a>                      <span class="fl">0.04</span> <span class="op">*</span> media_transformed[:, <span class="dv">3</span>] <span class="op">+</span>    <span class="co"># Radio small effect</span></span>
<span id="cb16-183"><a href="#cb16-183" aria-hidden="true" tabindex="-1"></a>                      <span class="fl">0.02</span> <span class="op">*</span> media_transformed[:, <span class="dv">4</span>] <span class="op">+</span>    <span class="co"># Print minimal effect</span></span>
<span id="cb16-184"><a href="#cb16-184" aria-hidden="true" tabindex="-1"></a>                      <span class="fl">0.05</span> <span class="op">*</span> seasonality <span class="op">+</span>                <span class="co"># Some seasonal variation</span></span>
<span id="cb16-185"><a href="#cb16-185" aria-hidden="true" tabindex="-1"></a>                      <span class="fl">0.03</span> <span class="op">*</span> np.random.randn(n_weeks))   <span class="co"># Random noise</span></span>
<span id="cb16-186"><a href="#cb16-186" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-187"><a href="#cb16-187" aria-hidden="true" tabindex="-1"></a>    purchase_intent <span class="op">=</span> np.clip(purchase_intent, <span class="dv">0</span>, <span class="fl">0.6</span>)  <span class="co"># Cap at 60% intent</span></span>
<span id="cb16-188"><a href="#cb16-188" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-189"><a href="#cb16-189" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ========================================</span></span>
<span id="cb16-190"><a href="#cb16-190" aria-hidden="true" tabindex="-1"></a>    <span class="co"># TRUE SALES GENERATION (Multiplicative Model)</span></span>
<span id="cb16-191"><a href="#cb16-191" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ========================================</span></span>
<span id="cb16-192"><a href="#cb16-192" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-193"><a href="#cb16-193" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-194"><a href="#cb16-194" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-195"><a href="#cb16-195" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Direct media effects (excluding path through purchase intent)</span></span>
<span id="cb16-196"><a href="#cb16-196" aria-hidden="true" tabindex="-1"></a>    <span class="co"># These are smaller because some effect goes through the mediator</span></span>
<span id="cb16-197"><a href="#cb16-197" aria-hidden="true" tabindex="-1"></a>    direct_media_effects <span class="op">=</span> np.array([<span class="fl">0.08</span>, <span class="fl">0.08</span>, <span class="fl">0.04</span>, <span class="fl">0.04</span>, <span class="fl">0.02</span>])</span>
<span id="cb16-198"><a href="#cb16-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-199"><a href="#cb16-199" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-200"><a href="#cb16-200" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Effect of purchase intent on sales</span></span>
<span id="cb16-201"><a href="#cb16-201" aria-hidden="true" tabindex="-1"></a>    purchase_intent_effect <span class="op">=</span> <span class="fl">2.0</span>  <span class="co"># Strong effect of intent on sales</span></span>
<span id="cb16-202"><a href="#cb16-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-203"><a href="#cb16-203" aria-hidden="true" tabindex="-1"></a>    <span class="co"># True TOTAL media effects (including path through purchase intent)</span></span>
<span id="cb16-204"><a href="#cb16-204" aria-hidden="true" tabindex="-1"></a>    true_total_media_effects <span class="op">=</span> indirect_media_effects <span class="op">*</span> purchase_intent_effect <span class="op">+</span> direct_media_effects </span>
<span id="cb16-205"><a href="#cb16-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-206"><a href="#cb16-206" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Base sales (log scale)</span></span>
<span id="cb16-207"><a href="#cb16-207" aria-hidden="true" tabindex="-1"></a>    log_base_sales <span class="op">=</span> <span class="fl">6.0</span>  <span class="co"># exp(6) ~ 403 base sales</span></span>
<span id="cb16-208"><a href="#cb16-208" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-209"><a href="#cb16-209" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build sales from true drivers only</span></span>
<span id="cb16-210"><a href="#cb16-210" aria-hidden="true" tabindex="-1"></a>    log_sales <span class="op">=</span> (log_base_sales <span class="op">+</span> </span>
<span id="cb16-211"><a href="#cb16-211" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Confounders</span></span>
<span id="cb16-212"><a href="#cb16-212" aria-hidden="true" tabindex="-1"></a>                <span class="fl">0.25</span> <span class="op">*</span> seasonality <span class="op">+</span></span>
<span id="cb16-213"><a href="#cb16-213" aria-hidden="true" tabindex="-1"></a>                <span class="fl">0.15</span> <span class="op">*</span> (consumer_confidence <span class="op">-</span> <span class="dv">100</span>) <span class="op">/</span> <span class="dv">20</span> <span class="op">+</span></span>
<span id="cb16-214"><a href="#cb16-214" aria-hidden="true" tabindex="-1"></a>                <span class="fl">0.35</span> <span class="op">*</span> holidays <span class="op">+</span></span>
<span id="cb16-215"><a href="#cb16-215" aria-hidden="true" tabindex="-1"></a>                <span class="op">-</span><span class="fl">0.20</span> <span class="op">*</span> (competitor_promos <span class="op">-</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb16-216"><a href="#cb16-216" aria-hidden="true" tabindex="-1"></a>                <span class="fl">0.10</span> <span class="op">*</span> product_lifecycle <span class="op">+</span></span>
<span id="cb16-217"><a href="#cb16-217" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Sales-only drivers  </span></span>
<span id="cb16-218"><a href="#cb16-218" aria-hidden="true" tabindex="-1"></a>                <span class="fl">0.30</span> <span class="op">*</span> np.log(distribution_index) <span class="op">+</span></span>
<span id="cb16-219"><a href="#cb16-219" aria-hidden="true" tabindex="-1"></a>                <span class="fl">0.20</span> <span class="op">*</span> (quality_score <span class="op">-</span> <span class="fl">4.0</span>) <span class="op">+</span></span>
<span id="cb16-220"><a href="#cb16-220" aria-hidden="true" tabindex="-1"></a>                <span class="fl">0.15</span> <span class="op">*</span> wom_momentum <span class="op">+</span></span>
<span id="cb16-221"><a href="#cb16-221" aria-hidden="true" tabindex="-1"></a>                <span class="co"># MEDIATOR effect</span></span>
<span id="cb16-222"><a href="#cb16-222" aria-hidden="true" tabindex="-1"></a>                purchase_intent_effect <span class="op">*</span> (purchase_intent <span class="op">-</span> purchase_intent_base))</span>
<span id="cb16-223"><a href="#cb16-223" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-224"><a href="#cb16-224" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add DIRECT media effects only</span></span>
<span id="cb16-225"><a href="#cb16-225" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_media):</span>
<span id="cb16-226"><a href="#cb16-226" aria-hidden="true" tabindex="-1"></a>        log_sales <span class="op">+=</span> direct_media_effects[i] <span class="op">*</span> media_transformed[:, i]</span>
<span id="cb16-227"><a href="#cb16-227" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-228"><a href="#cb16-228" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add noise</span></span>
<span id="cb16-229"><a href="#cb16-229" aria-hidden="true" tabindex="-1"></a>    log_sales <span class="op">+=</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.02</span>, n_weeks)</span>
<span id="cb16-230"><a href="#cb16-230" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-231"><a href="#cb16-231" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to sales</span></span>
<span id="cb16-232"><a href="#cb16-232" aria-hidden="true" tabindex="-1"></a>    sales <span class="op">=</span> np.exp(log_sales)</span>
<span id="cb16-233"><a href="#cb16-233" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-234"><a href="#cb16-234" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ========================================</span></span>
<span id="cb16-235"><a href="#cb16-235" aria-hidden="true" tabindex="-1"></a>    <span class="co"># COLLIDER (affected by both media and sales)</span></span>
<span id="cb16-236"><a href="#cb16-236" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ========================================</span></span>
<span id="cb16-237"><a href="#cb16-237" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-238"><a href="#cb16-238" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Brand awareness surveys - caused by both advertising and sales success</span></span>
<span id="cb16-239"><a href="#cb16-239" aria-hidden="true" tabindex="-1"></a>    brand_awareness <span class="op">=</span> (<span class="dv">20</span> <span class="op">+</span>  <span class="co"># Base awareness</span></span>
<span id="cb16-240"><a href="#cb16-240" aria-hidden="true" tabindex="-1"></a>                      <span class="dv">15</span> <span class="op">*</span> (media_transformed[:, <span class="dv">0</span>] <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> media_transformed[:, <span class="dv">1</span>]) <span class="op">+</span>  <span class="co"># TV and Digital drive awareness</span></span>
<span id="cb16-241"><a href="#cb16-241" aria-hidden="true" tabindex="-1"></a>                      <span class="dv">10</span> <span class="op">*</span> (sales <span class="op">/</span> sales.mean() <span class="op">-</span> <span class="dv">1</span>) <span class="op">+</span>  <span class="co"># Success drives awareness</span></span>
<span id="cb16-242"><a href="#cb16-242" aria-hidden="true" tabindex="-1"></a>                      <span class="dv">5</span> <span class="op">*</span> np.random.randn(n_weeks))  <span class="co"># Noise</span></span>
<span id="cb16-243"><a href="#cb16-243" aria-hidden="true" tabindex="-1"></a>    brand_awareness <span class="op">=</span> np.clip(brand_awareness, <span class="dv">0</span>, <span class="dv">100</span>)</span>
<span id="cb16-244"><a href="#cb16-244" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-245"><a href="#cb16-245" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ========================================</span></span>
<span id="cb16-246"><a href="#cb16-246" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CREATE DATAFRAME</span></span>
<span id="cb16-247"><a href="#cb16-247" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ========================================</span></span>
<span id="cb16-248"><a href="#cb16-248" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-249"><a href="#cb16-249" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb16-250"><a href="#cb16-250" aria-hidden="true" tabindex="-1"></a>        <span class="st">'week'</span>: t,</span>
<span id="cb16-251"><a href="#cb16-251" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sales'</span>: sales,</span>
<span id="cb16-252"><a href="#cb16-252" aria-hidden="true" tabindex="-1"></a>        <span class="st">'log_sales'</span>: log_sales,</span>
<span id="cb16-253"><a href="#cb16-253" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-254"><a href="#cb16-254" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Confounders</span></span>
<span id="cb16-255"><a href="#cb16-255" aria-hidden="true" tabindex="-1"></a>        <span class="st">'seasonality'</span>: seasonality,</span>
<span id="cb16-256"><a href="#cb16-256" aria-hidden="true" tabindex="-1"></a>        <span class="st">'gdp_growth'</span>: gdp_growth,</span>
<span id="cb16-257"><a href="#cb16-257" aria-hidden="true" tabindex="-1"></a>        <span class="st">'unemployment'</span>: unemployment,</span>
<span id="cb16-258"><a href="#cb16-258" aria-hidden="true" tabindex="-1"></a>        <span class="st">'consumer_confidence'</span>: consumer_confidence,</span>
<span id="cb16-259"><a href="#cb16-259" aria-hidden="true" tabindex="-1"></a>        <span class="st">'holidays'</span>: holidays,</span>
<span id="cb16-260"><a href="#cb16-260" aria-hidden="true" tabindex="-1"></a>        <span class="st">'competitor_promos'</span>: competitor_promos,</span>
<span id="cb16-261"><a href="#cb16-261" aria-hidden="true" tabindex="-1"></a>        <span class="st">'product_lifecycle'</span>: product_lifecycle,</span>
<span id="cb16-262"><a href="#cb16-262" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-263"><a href="#cb16-263" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Sales drivers (not media drivers)</span></span>
<span id="cb16-264"><a href="#cb16-264" aria-hidden="true" tabindex="-1"></a>        <span class="st">'distribution_index'</span>: distribution_index,</span>
<span id="cb16-265"><a href="#cb16-265" aria-hidden="true" tabindex="-1"></a>        <span class="st">'quality_score'</span>: quality_score,</span>
<span id="cb16-266"><a href="#cb16-266" aria-hidden="true" tabindex="-1"></a>        <span class="st">'word_of_mouth'</span>: wom_momentum,</span>
<span id="cb16-267"><a href="#cb16-267" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-268"><a href="#cb16-268" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Red herrings (don't affect sales)</span></span>
<span id="cb16-269"><a href="#cb16-269" aria-hidden="true" tabindex="-1"></a>        <span class="st">'temperature'</span>: temperature,</span>
<span id="cb16-270"><a href="#cb16-270" aria-hidden="true" tabindex="-1"></a>        <span class="st">'precipitation'</span>: precipitation,</span>
<span id="cb16-271"><a href="#cb16-271" aria-hidden="true" tabindex="-1"></a>        <span class="st">'stock_index'</span>: stock_index,</span>
<span id="cb16-272"><a href="#cb16-272" aria-hidden="true" tabindex="-1"></a>        <span class="st">'social_followers'</span>: social_followers,</span>
<span id="cb16-273"><a href="#cb16-273" aria-hidden="true" tabindex="-1"></a>        <span class="st">'website_traffic'</span>: website_traffic,</span>
<span id="cb16-274"><a href="#cb16-274" aria-hidden="true" tabindex="-1"></a>        <span class="st">'num_skus'</span>: num_skus,</span>
<span id="cb16-275"><a href="#cb16-275" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-276"><a href="#cb16-276" aria-hidden="true" tabindex="-1"></a>        <span class="co"># MEDIATOR</span></span>
<span id="cb16-277"><a href="#cb16-277" aria-hidden="true" tabindex="-1"></a>        <span class="st">'purchase_intent'</span>: purchase_intent,</span>
<span id="cb16-278"><a href="#cb16-278" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-279"><a href="#cb16-279" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Collider</span></span>
<span id="cb16-280"><a href="#cb16-280" aria-hidden="true" tabindex="-1"></a>        <span class="st">'brand_awareness'</span>: brand_awareness</span>
<span id="cb16-281"><a href="#cb16-281" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb16-282"><a href="#cb16-282" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-283"><a href="#cb16-283" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add media variables</span></span>
<span id="cb16-284"><a href="#cb16-284" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, name <span class="kw">in</span> <span class="bu">enumerate</span>(media_names):</span>
<span id="cb16-285"><a href="#cb16-285" aria-hidden="true" tabindex="-1"></a>        data[<span class="ss">f'</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">_spend'</span>] <span class="op">=</span> media_spend_raw[:, i]</span>
<span id="cb16-286"><a href="#cb16-286" aria-hidden="true" tabindex="-1"></a>        data[<span class="ss">f'</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">_spend_scaled'</span>] <span class="op">=</span> media_spend_scaled[:, i]</span>
<span id="cb16-287"><a href="#cb16-287" aria-hidden="true" tabindex="-1"></a>        data[<span class="ss">f'</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">_transformed'</span>] <span class="op">=</span> media_transformed[:, i]</span>
<span id="cb16-288"><a href="#cb16-288" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-289"><a href="#cb16-289" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create some derived features that stepwise might pick up</span></span>
<span id="cb16-290"><a href="#cb16-290" aria-hidden="true" tabindex="-1"></a>    data[<span class="st">'temp_squared'</span>] <span class="op">=</span> data[<span class="st">'temperature'</span>] <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb16-291"><a href="#cb16-291" aria-hidden="true" tabindex="-1"></a>    data[<span class="st">'awareness_change'</span>] <span class="op">=</span> data[<span class="st">'brand_awareness'</span>].diff().fillna(<span class="dv">0</span>)</span>
<span id="cb16-292"><a href="#cb16-292" aria-hidden="true" tabindex="-1"></a>    data[<span class="st">'intent_change'</span>] <span class="op">=</span> data[<span class="st">'purchase_intent'</span>].diff().fillna(<span class="dv">0</span>)</span>
<span id="cb16-293"><a href="#cb16-293" aria-hidden="true" tabindex="-1"></a>    data[<span class="st">'spend_total'</span>] <span class="op">=</span> media_spend_raw.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-294"><a href="#cb16-294" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-295"><a href="#cb16-295" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data, true_total_media_effects, direct_media_effects, {<span class="st">"indirect"</span>: indirect_media_effects,<span class="st">"alphas"</span>: alphas, <span class="st">"k_values"</span>: k_values} , media_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
True Market Structure
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell fig-cap-location-bottom" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-causal-graph" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-causal-graph-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<svg width="672" height="480" viewbox="0.00 0.00 1414.85 332.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 328)">
<title>Market Structure</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-328 1410.85,-328 1410.85,4 -4,4"></polygon>
<!-- Seasonality -->
<g id="node1" class="node">
<title>Seasonality</title>
<ellipse fill="none" stroke="#afb3b7" stroke-dasharray="5,2" cx="200.91" cy="-306" rx="55.62" ry="18"></ellipse>
<text text-anchor="middle" x="200.91" y="-301.8" font-family="Times,serif" font-size="14.00">Seasonality</text>
</g>
<!-- Paid Media -->
<g id="node3" class="node">
<title>Paid Media</title>
<ellipse fill="none" stroke="black" cx="588.91" cy="-234" rx="55.08" ry="18"></ellipse>
<text text-anchor="middle" x="588.91" y="-229.8" font-family="Times,serif" font-size="14.00">Paid Media</text>
</g>
<!-- Seasonality&#45;&gt;Paid Media -->
<g id="edge1" class="edge">
<title>Seasonality-&gt;Paid Media</title>
<path fill="none" stroke="black" d="M241.68,-293.72C249.68,-291.68 258.03,-289.67 265.91,-288 356.92,-268.67 463.65,-252.39 528.75,-243.16"></path>
<polygon fill="black" stroke="black" points="529.42,-246.6 538.84,-241.74 528.45,-239.67 529.42,-246.6"></polygon>
</g>
<!-- Sales -->
<g id="node9" class="node">
<title>Sales</title>
<ellipse fill="none" stroke="black" cx="781.91" cy="-90" rx="31.34" ry="18"></ellipse>
<text text-anchor="middle" x="781.91" y="-85.8" font-family="Times,serif" font-size="14.00">Sales</text>
</g>
<!-- Seasonality&#45;&gt;Sales -->
<g id="edge8" class="edge">
<title>Seasonality-&gt;Sales</title>
<path fill="none" stroke="black" d="M224.02,-289.45C238.52,-279.34 257.35,-265.57 272.91,-252 323.37,-208.01 318.07,-174.02 377.91,-144 440.93,-112.38 650.79,-97.87 740.58,-92.99"></path>
<polygon fill="black" stroke="black" points="740.86,-96.48 750.66,-92.46 740.49,-89.49 740.86,-96.48"></polygon>
</g>
<!-- Tempurature -->
<g id="node15" class="node">
<title>Tempurature</title>
<ellipse fill="none" stroke="black" cx="60.91" cy="-234" rx="60.81" ry="18"></ellipse>
<text text-anchor="middle" x="60.91" y="-229.8" font-family="Times,serif" font-size="14.00">Tempurature</text>
</g>
<!-- Seasonality&#45;&gt;Tempurature -->
<g id="edge21" class="edge">
<title>Seasonality-&gt;Tempurature</title>
<path fill="none" stroke="black" d="M171.9,-290.5C151.06,-280.08 122.74,-265.92 99.93,-254.51"></path>
<polygon fill="black" stroke="black" points="101.35,-251.31 90.84,-249.97 98.22,-257.57 101.35,-251.31"></polygon>
</g>
<!-- Percepitation -->
<g id="node16" class="node">
<title>Percepitation</title>
<ellipse fill="none" stroke="black" cx="201.91" cy="-234" rx="61.97" ry="18"></ellipse>
<text text-anchor="middle" x="201.91" y="-229.8" font-family="Times,serif" font-size="14.00">Percepitation</text>
</g>
<!-- Seasonality&#45;&gt;Percepitation -->
<g id="edge22" class="edge">
<title>Seasonality-&gt;Percepitation</title>
<path fill="none" stroke="black" d="M201.15,-287.7C201.26,-279.98 201.4,-270.71 201.52,-262.11"></path>
<polygon fill="black" stroke="black" points="205.02,-262.15 201.66,-252.1 198.02,-262.05 205.02,-262.15"></polygon>
</g>
<!-- Product Lifecycle -->
<g id="node2" class="node">
<title>Product Lifecycle</title>
<ellipse fill="none" stroke="#afb3b7" stroke-dasharray="5,2" cx="1326.91" cy="-306" rx="79.89" ry="18"></ellipse>
<text text-anchor="middle" x="1326.91" y="-301.8" font-family="Times,serif" font-size="14.00">Product Lifecycle</text>
</g>
<!-- Product Lifecycle&#45;&gt;Paid Media -->
<g id="edge7" class="edge">
<title>Product Lifecycle-&gt;Paid Media</title>
<path fill="none" stroke="black" d="M1255.36,-297.85C1224.47,-294.78 1187.91,-291.18 1154.91,-288 972.13,-270.41 756.06,-250.39 651.64,-240.77"></path>
<polygon fill="black" stroke="black" points="651.86,-237.27 641.59,-239.84 651.22,-244.24 651.86,-237.27"></polygon>
</g>
<!-- Product Lifecycle&#45;&gt;Sales -->
<g id="edge14" class="edge">
<title>Product Lifecycle-&gt;Sales</title>
<path fill="none" stroke="black" d="M1334.16,-288.06C1346.81,-255.54 1368.29,-184.06 1331.91,-144 1297.87,-106.52 945.98,-94.82 823.59,-91.86"></path>
<polygon fill="black" stroke="black" points="823.57,-88.36 813.49,-91.62 823.4,-95.36 823.57,-88.36"></polygon>
</g>
<!-- Website Visits -->
<g id="node13" class="node">
<title>Website Visits</title>
<ellipse fill="none" stroke="black" cx="666.91" cy="-162" rx="67.76" ry="18"></ellipse>
<text text-anchor="middle" x="666.91" y="-157.8" font-family="Times,serif" font-size="14.00">Website Visits</text>
</g>
<!-- Paid Media&#45;&gt;Website Visits -->
<g id="edge18" class="edge">
<title>Paid Media-&gt;Website Visits</title>
<path fill="none" stroke="black" d="M607,-216.76C617.06,-207.73 629.77,-196.33 640.89,-186.35"></path>
<polygon fill="black" stroke="black" points="643.54,-188.67 648.64,-179.39 638.86,-183.46 643.54,-188.67"></polygon>
</g>
<!-- Purchase Intent -->
<g id="node14" class="node">
<title>Purchase Intent</title>
<ellipse fill="none" stroke="black" cx="510.91" cy="-162" rx="70.67" ry="18"></ellipse>
<text text-anchor="middle" x="510.91" y="-157.8" font-family="Times,serif" font-size="14.00">Purchase Intent</text>
</g>
<!-- Paid Media&#45;&gt;Purchase Intent -->
<g id="edge19" class="edge">
<title>Paid Media-&gt;Purchase Intent</title>
<path fill="none" stroke="black" d="M570.81,-216.76C560.82,-207.79 548.22,-196.49 537.16,-186.56"></path>
<polygon fill="black" stroke="black" points="539.22,-183.71 529.44,-179.63 534.54,-188.92 539.22,-183.71"></polygon>
</g>
<!-- Brand Awareness -->
<g id="node17" class="node">
<title>Brand Awareness</title>
<ellipse fill="none" stroke="black" cx="586.91" cy="-18" rx="79.34" ry="18"></ellipse>
<text text-anchor="middle" x="586.91" y="-13.8" font-family="Times,serif" font-size="14.00">Brand Awareness</text>
</g>
<!-- Paid Media&#45;&gt;Brand Awareness -->
<g id="edge24" class="edge">
<title>Paid Media-&gt;Brand Awareness</title>
<path fill="none" stroke="black" d="M534.39,-230.31C498.63,-225.37 454.31,-212.53 430.91,-180 390.24,-123.47 482.63,-67.31 541.94,-38.62"></path>
<polygon fill="black" stroke="black" points="543.62,-41.7 551.15,-34.26 540.62,-35.37 543.62,-41.7"></polygon>
</g>
<!-- GDP Growth -->
<g id="node4" class="node">
<title>GDP Growth</title>
<ellipse fill="none" stroke="black" cx="336.91" cy="-306" rx="62.05" ry="18"></ellipse>
<text text-anchor="middle" x="336.91" y="-301.8" font-family="Times,serif" font-size="14.00">GDP Growth</text>
</g>
<!-- GDP Growth&#45;&gt;Paid Media -->
<g id="edge2" class="edge">
<title>GDP Growth-&gt;Paid Media</title>
<path fill="none" stroke="black" d="M380.23,-292.97C424.15,-280.77 492.06,-261.9 538.4,-249.03"></path>
<polygon fill="black" stroke="black" points="539.53,-252.35 548.23,-246.3 537.66,-245.6 539.53,-252.35"></polygon>
</g>
<!-- GDP Growth&#45;&gt;Sales -->
<g id="edge9" class="edge">
<title>GDP Growth-&gt;Sales</title>
<path fill="none" stroke="black" d="M339.7,-287.77C346.13,-254.08 365.35,-179.69 413.91,-144 465.14,-106.34 655.5,-95.25 740.48,-92.15"></path>
<polygon fill="black" stroke="black" points="740.67,-95.64 750.55,-91.8 740.43,-88.65 740.67,-95.64"></polygon>
</g>
<!-- Unemployment -->
<g id="node5" class="node">
<title>Unemployment</title>
<ellipse fill="none" stroke="black" cx="487.91" cy="-306" rx="71.23" ry="18"></ellipse>
<text text-anchor="middle" x="487.91" y="-301.8" font-family="Times,serif" font-size="14.00">Unemployment</text>
</g>
<!-- Unemployment&#45;&gt;Paid Media -->
<g id="edge3" class="edge">
<title>Unemployment-&gt;Paid Media</title>
<path fill="none" stroke="black" d="M511.08,-288.94C525,-279.29 542.89,-266.89 558.01,-256.41"></path>
<polygon fill="black" stroke="black" points="560.31,-259.08 566.54,-250.5 556.32,-253.32 560.31,-259.08"></polygon>
</g>
<!-- Unemployment&#45;&gt;Sales -->
<g id="edge10" class="edge">
<title>Unemployment-&gt;Sales</title>
<path fill="none" stroke="black" d="M472.04,-287.94C444.4,-256.14 393.78,-187.16 430.91,-144 470.37,-98.13 655.78,-91.45 740.05,-90.82"></path>
<polygon fill="black" stroke="black" points="740.3,-94.32 750.28,-90.77 740.27,-87.32 740.3,-94.32"></polygon>
</g>
<!-- Consumer Confidence -->
<g id="node6" class="node">
<title>Consumer Confidence</title>
<ellipse fill="none" stroke="black" cx="674.91" cy="-306" rx="97.82" ry="18"></ellipse>
<text text-anchor="middle" x="674.91" y="-301.8" font-family="Times,serif" font-size="14.00">Consumer Confidence</text>
</g>
<!-- Consumer Confidence&#45;&gt;Paid Media -->
<g id="edge4" class="edge">
<title>Consumer Confidence-&gt;Paid Media</title>
<path fill="none" stroke="black" d="M654.09,-288.05C642.86,-278.92 628.85,-267.51 616.7,-257.63"></path>
<polygon fill="black" stroke="black" points="618.61,-254.67 608.65,-251.07 614.19,-260.09 618.61,-254.67"></polygon>
</g>
<!-- Consumer Confidence&#45;&gt;Sales -->
<g id="edge11" class="edge">
<title>Consumer Confidence-&gt;Sales</title>
<path fill="none" stroke="black" d="M685.07,-287.9C699.05,-264.09 724.67,-219.43 743.91,-180 754.05,-159.2 764.28,-135.02 771.57,-117.12"></path>
<polygon fill="black" stroke="black" points="774.9,-118.21 775.39,-107.63 768.41,-115.59 774.9,-118.21"></polygon>
</g>
<!-- Holidays -->
<g id="node7" class="node">
<title>Holidays</title>
<ellipse fill="none" stroke="black" cx="836.91" cy="-306" rx="45.81" ry="18"></ellipse>
<text text-anchor="middle" x="836.91" y="-301.8" font-family="Times,serif" font-size="14.00">Holidays</text>
</g>
<!-- Holidays&#45;&gt;Paid Media -->
<g id="edge5" class="edge">
<title>Holidays-&gt;Paid Media</title>
<path fill="none" stroke="black" d="M802.34,-294.13C795.57,-292.06 788.53,-289.93 781.91,-288 734.14,-274.06 679.42,-259.13 640.47,-248.68"></path>
<polygon fill="black" stroke="black" points="640.99,-245.2 630.43,-245.99 639.18,-251.96 640.99,-245.2"></polygon>
</g>
<!-- Holidays&#45;&gt;Sales -->
<g id="edge12" class="edge">
<title>Holidays-&gt;Sales</title>
<path fill="none" stroke="black" d="M832.5,-287.85C822.94,-250.66 800.25,-162.37 788.79,-117.77"></path>
<polygon fill="black" stroke="black" points="792.14,-116.75 786.26,-107.94 785.36,-118.49 792.14,-116.75"></polygon>
</g>
<!-- Competitor Promotions -->
<g id="node8" class="node">
<title>Competitor Promotions</title>
<ellipse fill="none" stroke="black" cx="1043.91" cy="-306" rx="101.95" ry="18"></ellipse>
<text text-anchor="middle" x="1043.91" y="-301.8" font-family="Times,serif" font-size="14.00">Competitor Promotions</text>
</g>
<!-- Competitor Promotions&#45;&gt;Paid Media -->
<g id="edge6" class="edge">
<title>Competitor Promotions-&gt;Paid Media</title>
<path fill="none" stroke="black" d="M969.79,-293.6C879.86,-279.76 730.09,-256.72 647.7,-244.05"></path>
<polygon fill="black" stroke="black" points="648.17,-240.58 637.75,-242.52 647.11,-247.5 648.17,-240.58"></polygon>
</g>
<!-- Competitor Promotions&#45;&gt;Sales -->
<g id="edge13" class="edge">
<title>Competitor Promotions-&gt;Sales</title>
<path fill="none" stroke="black" d="M1108.83,-292.03C1207.82,-269.54 1378.27,-218.46 1310.91,-144 1278.37,-108.04 942.75,-95.4 823.59,-92.03"></path>
<polygon fill="black" stroke="black" points="823.5,-88.53 813.41,-91.75 823.31,-95.52 823.5,-88.53"></polygon>
</g>
<!-- Sales&#45;&gt;Brand Awareness -->
<g id="edge23" class="edge">
<title>Sales-&gt;Brand Awareness</title>
<path fill="none" stroke="black" d="M756.01,-79.7C725.86,-68.88 675.36,-50.75 637.38,-37.12"></path>
<polygon fill="black" stroke="black" points="638.11,-33.66 627.52,-33.58 635.75,-40.25 638.11,-33.66"></polygon>
</g>
<!-- Distribution Index -->
<g id="node10" class="node">
<title>Distribution Index</title>
<ellipse fill="none" stroke="black" cx="910.91" cy="-162" rx="82.23" ry="18"></ellipse>
<text text-anchor="middle" x="910.91" y="-157.8" font-family="Times,serif" font-size="14.00">Distribution Index</text>
</g>
<!-- Distribution Index&#45;&gt;Sales -->
<g id="edge15" class="edge">
<title>Distribution Index-&gt;Sales</title>
<path fill="none" stroke="black" d="M881.63,-145.12C861.04,-133.94 833.54,-119.02 812.63,-107.67"></path>
<polygon fill="black" stroke="black" points="814.29,-104.59 803.83,-102.9 810.95,-110.74 814.29,-104.59"></polygon>
</g>
<!-- Quality Score -->
<g id="node11" class="node">
<title>Quality Score</title>
<ellipse fill="none" stroke="black" cx="1075.91" cy="-162" rx="64.31" ry="18"></ellipse>
<text text-anchor="middle" x="1075.91" y="-157.8" font-family="Times,serif" font-size="14.00">Quality Score</text>
</g>
<!-- Quality Score&#45;&gt;Sales -->
<g id="edge16" class="edge">
<title>Quality Score-&gt;Sales</title>
<path fill="none" stroke="black" d="M1028.67,-149.75C970.72,-135.96 873.62,-112.84 820.13,-100.1"></path>
<polygon fill="black" stroke="black" points="820.89,-96.68 810.35,-97.77 819.27,-103.49 820.89,-96.68"></polygon>
</g>
<!-- Word of Mouth -->
<g id="node12" class="node">
<title>Word of Mouth</title>
<ellipse fill="none" stroke="black" cx="1229.91" cy="-162" rx="71.8" ry="18"></ellipse>
<text text-anchor="middle" x="1229.91" y="-157.8" font-family="Times,serif" font-size="14.00">Word of Mouth</text>
</g>
<!-- Word of Mouth&#45;&gt;Sales -->
<g id="edge17" class="edge">
<title>Word of Mouth-&gt;Sales</title>
<path fill="none" stroke="black" d="M1177.71,-149.54C1168.15,-147.58 1158.24,-145.65 1148.91,-144 1030.97,-123.13 890.62,-104.6 822.72,-96.03"></path>
<polygon fill="black" stroke="black" points="822.82,-92.52 812.46,-94.75 821.95,-99.46 822.82,-92.52"></polygon>
</g>
<!-- Purchase Intent&#45;&gt;Sales -->
<g id="edge20" class="edge">
<title>Purchase Intent-&gt;Sales</title>
<path fill="none" stroke="black" d="M558.73,-148.65C611.5,-135.02 695.37,-113.35 743.86,-100.83"></path>
<polygon fill="black" stroke="black" points="744.84,-104.19 753.65,-98.3 743.09,-97.41 744.84,-104.19"></polygon>
</g>
</g>
</svg>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-causal-graph-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: This graph shows the actual data generating model. We typically do not have access to the full model and often we are missing data or have imperfect measures of the data.
</figcaption>
</figure>
</div>
</div>
</div>
<div id="cell-70" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the data</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>data, true_total_effects, true_direct_effects, params, media_names <span class="op">=</span> generate_synthetic_mmm_data(random_seed<span class="op">=</span><span class="dv">12</span>, n_weeks<span class="op">=</span><span class="dv">362</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">True TOTAL media effects (including indirect path): </span><span class="sc">{</span><span class="bu">dict</span>(<span class="bu">zip</span>(media_names, true_total_effects))<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True DIRECT media effects (excluding mediator path): </span><span class="sc">{</span><span class="bu">dict</span>(<span class="bu">zip</span>(media_names, true_direct_effects))<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
True TOTAL media effects (including indirect path): {'TV': np.float64(0.32), 'Digital': np.float64(0.28), 'Social': np.float64(0.2), 'Radio': np.float64(0.12), 'Print': np.float64(0.06)}
True DIRECT media effects (excluding mediator path): {'TV': np.float64(0.08), 'Digital': np.float64(0.08), 'Social': np.float64(0.04), 'Radio': np.float64(0.04), 'Print': np.float64(0.02)}</code></pre>
</div>
</div>
<div id="cell-72" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>plt.plot(data[<span class="st">'TV_spend'</span>].sort_values(), cont[<span class="st">'TV_spend'</span>].sort_values()<span class="op">*</span><span class="dv">100</span>, label<span class="op">=</span><span class="st">'TV Spend Contribution'</span>, color<span class="op">=</span><span class="st">'C0'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>plt.plot(data[<span class="st">'Digital_spend'</span>].sort_values(), cont[<span class="st">'Digital_spend'</span>].sort_values()<span class="op">*</span><span class="dv">100</span>, label<span class="op">=</span><span class="st">'Digital Spend Contribution'</span>, color<span class="op">=</span><span class="st">'C1'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>plt.plot(data[<span class="st">'Social_spend'</span>].sort_values(), cont[<span class="st">'Social_spend'</span>].sort_values()<span class="op">*</span><span class="dv">100</span>, label<span class="op">=</span><span class="st">'Social Spend Contribution'</span>, color<span class="op">=</span><span class="st">'C2'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>plt.plot(data[<span class="st">'Print_spend'</span>].sort_values(), cont[<span class="st">'Print_spend'</span>].sort_values()<span class="op">*</span><span class="dv">100</span>, label<span class="op">=</span><span class="st">'Print Spend Contribution'</span>, color<span class="op">=</span><span class="st">'C3'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>plt.plot(data[<span class="st">'Radio_spend'</span>].sort_values(), cont[<span class="st">'Radio_spend'</span>].sort_values()<span class="op">*</span><span class="dv">100</span>, label<span class="op">=</span><span class="st">'Radio Spend Contribution'</span>, color<span class="op">=</span><span class="st">'C4'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Spend"</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"</span><span class="sc">% Li</span><span class="st">ft to Sales"</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Media Spend Contribution to Sales"</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="02_the_illusion_of_significance_files/figure-html/cell-29-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">GDP</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Unemployment</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">CCI</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false">Sales</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div id="cell-76" class="cell">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="02_the_illusion_of_significance_files/figure-html/cell-31-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div id="cell-78" class="cell">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="02_the_illusion_of_significance_files/figure-html/cell-32-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div id="cell-80" class="cell">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="02_the_illusion_of_significance_files/figure-html/cell-33-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<div id="cell-82" class="cell">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="02_the_illusion_of_significance_files/figure-html/cell-34-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Digital</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Print</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false">Social</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-4" role="tab" aria-controls="tabset-5-4" aria-selected="false">TV</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-5" role="tab" aria-controls="tabset-5-5" aria-selected="false">Radio</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div id="cell-85" class="cell">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="02_the_illusion_of_significance_files/figure-html/cell-35-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div id="cell-87" class="cell">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="02_the_illusion_of_significance_files/figure-html/cell-36-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<div id="cell-89" class="cell">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="02_the_illusion_of_significance_files/figure-html/cell-37-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-4-tab">
<div id="cell-91" class="cell">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="02_the_illusion_of_significance_files/figure-html/cell-38-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-5-tab">
<div id="cell-93" class="cell">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="02_the_illusion_of_significance_files/figure-html/cell-39-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="approach-a-the-frequentist-p-value-theater" class="level3">
<h3 class="anchored" data-anchor-id="approach-a-the-frequentist-p-value-theater">2. Approach A: The Frequentist P-Value Theater</h3>
<section id="the-analysts-ritual" class="level4">
<h4 class="anchored" data-anchor-id="the-analysts-ritual">2.1 The Analyst’s Ritual</h4>
<ul>
<li>Variable selection via stepwise regression</li>
<li>Transformation shopping for media curves</li>
<li>Chasing significance across model specifications</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Base Variable Selection Code
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="cell-97" class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prepare_features_for_selection(data, media_names):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Prepare all possible features for stepwise selection</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> pd.DataFrame()</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    media_features <span class="op">=</span> pd.DataFrame()</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Media variables (transformed) (assuming transformation is already known)</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for name in media_names:</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     features[f'{name}'] = data[f'{name}_transformed']</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># All potential control variables (mixing good and bad)</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    control_vars <span class="op">=</span> [</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">#'seasonality', # True Seasonality is often un-observed</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'gdp_growth'</span>, <span class="st">'unemployment'</span>, <span class="st">'consumer_confidence'</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'holidays'</span>, <span class="st">'competitor_promos'</span>, <span class="st">'product_lifecycle'</span>,</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'distribution_index'</span>, <span class="st">'quality_score'</span>, <span class="st">'word_of_mouth'</span>,</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'temperature'</span>, <span class="st">'precipitation'</span>, <span class="st">'stock_index'</span>,</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'social_followers'</span>, <span class="st">'website_traffic'</span>, <span class="st">'num_skus'</span>,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'purchase_intent'</span>,  <span class="co"># The MEDIATOR!</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'brand_awareness'</span>,  <span class="co"># The collider!</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'temp_squared'</span>, <span class="st">'awareness_change'</span>, <span class="st">'intent_change'</span> <span class="co"># 'spend_total'</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> var <span class="kw">in</span> control_vars:</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> var <span class="kw">in</span> data.columns:</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>            features[var] <span class="op">=</span> data[var]</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # Add some interaction terms (fishing expedition)</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># features['TV_x_holidays'] = data['TV_transformed'] * data['holidays']</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># features['Digital_x_confidence'] = data['Digital_transformed'] * data['consumer_confidence'] / 100</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># features['Social_x_lifecycle'] = data['Social_transformed'] * data['product_lifecycle']</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># features['TV_x_intent'] = data['TV_transformed'] * data['purchase_intent']  # Interaction with mediator!</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> media <span class="kw">in</span> media_names:</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>        media_features[<span class="ss">f"</span><span class="sc">{</span>media<span class="sc">}</span><span class="ss">_transformed"</span>] <span class="op">=</span> data[<span class="ss">f'</span><span class="sc">{</span>media<span class="sc">}</span><span class="ss">_transformed'</span>]</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> media, half_sat, n <span class="kw">in</span> product(media_names, np.linspace(<span class="fl">0.3</span>, <span class="fl">0.8</span>, <span class="dv">6</span>), np.linspace(<span class="fl">1.0</span>, <span class="fl">2.0</span>, <span class="dv">11</span>)):</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>        media_features[<span class="ss">f'</span><span class="sc">{</span>media<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>half_sat<span class="sc">:0.2f}</span><span class="ss">_</span><span class="sc">{</span>n<span class="sc">:0.2f}</span><span class="ss">'</span>] <span class="op">=</span> hill_transformation(data[<span class="ss">f'</span><span class="sc">{</span>media<span class="sc">}</span><span class="ss">_spend_scaled'</span>], n, half_sat)</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># add lagged variables for more complexity</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> media <span class="kw">in</span> media_names[:<span class="dv">2</span>]:</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>            media_features[<span class="ss">f'</span><span class="sc">{</span>media<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>half_sat<span class="sc">:0.2f}</span><span class="ss">_</span><span class="sc">{</span>n<span class="sc">:0.2f}</span><span class="ss">_lag1'</span>] <span class="op">=</span> media_features[<span class="ss">f'</span><span class="sc">{</span>media<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>half_sat<span class="sc">:0.2f}</span><span class="ss">_</span><span class="sc">{</span>n<span class="sc">:0.2f}</span><span class="ss">'</span>].shift(<span class="dv">1</span>).fillna(<span class="dv">0</span>)</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # Add lagged variables (more complexity)</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for name in media_names[:2]:  # Just TV and Digital to avoid too many variables</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     features[f'{name}_lag1'] = data[f'{name}_transformed'].shift(1).fillna(0)</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Time trends</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>    features[<span class="st">'trend'</span>] <span class="op">=</span> np.arange(<span class="bu">len</span>(data)) <span class="op">/</span> <span class="bu">len</span>(data)</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>    features[<span class="st">'trend_sq'</span>] <span class="op">=</span> features[<span class="st">'trend'</span>] <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>    features[<span class="st">'log_distribution_index'</span>] <span class="op">=</span> np.log(features[<span class="st">'distribution_index'</span>])</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> features, media_features</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> stepwise_selection(X, y, threshold_in<span class="op">=</span><span class="fl">0.05</span>, threshold_out<span class="op">=</span><span class="fl">0.10</span>, verbose<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="co">    Forward-backward stepwise selection based on p-values</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>    included <span class="op">=</span> []</span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>    excluded <span class="op">=</span> <span class="bu">list</span>(X.columns)</span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>    best_aic <span class="op">=</span> np.inf</span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose:</span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Starting stepwise selection..."</span>)</span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Total candidate variables: </span><span class="sc">{</span><span class="bu">len</span>(excluded)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>    step <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>        changed <span class="op">=</span> <span class="va">False</span></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Forward step</span></span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>        excluded_copy <span class="op">=</span> excluded.copy()</span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>        best_pvalue <span class="op">=</span> threshold_in <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>        best_feature <span class="op">=</span> <span class="va">None</span></span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> feature <span class="kw">in</span> excluded_copy:</span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>            features <span class="op">=</span> included <span class="op">+</span> [feature]</span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>            X_subset <span class="op">=</span> X[features]</span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>            X_with_const <span class="op">=</span> sm.add_constant(X_subset, has_constant<span class="op">=</span><span class="st">'add'</span>)</span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>                model <span class="op">=</span> sm.OLS(y, X_with_const).fit()</span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a>                p_value <span class="op">=</span> model.pvalues[feature]</span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> p_value <span class="op">&lt;</span> best_pvalue:</span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a>                    best_pvalue <span class="op">=</span> p_value</span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>                    best_feature <span class="op">=</span> feature</span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a>                    best_aic_candidate <span class="op">=</span> model.aic</span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span>:</span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> best_feature <span class="kw">and</span> best_pvalue <span class="op">&lt;</span> threshold_in:</span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a>            included.append(best_feature)</span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a>            excluded.remove(best_feature)</span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>            changed <span class="op">=</span> <span class="va">True</span></span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a>            step <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a>            best_aic <span class="op">=</span> best_aic_candidate</span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> verbose:</span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"Step </span><span class="sc">{</span>step<span class="sc">:3d}</span><span class="ss"> - ADDED '</span><span class="sc">{</span>best_feature<span class="sc">:25s}</span><span class="ss">' (p=</span><span class="sc">{</span>best_pvalue<span class="sc">:.4f}</span><span class="ss">, AIC=</span><span class="sc">{</span>best_aic<span class="sc">:.1f}</span><span class="ss">)"</span>)</span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Backward step</span></span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(included) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a>            X_subset <span class="op">=</span> X[included]</span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a>            X_with_const <span class="op">=</span> sm.add_constant(X_subset, has_constant<span class="op">=</span><span class="st">'add'</span>)</span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> sm.OLS(y, X_with_const).fit()</span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Find worst p-value</span></span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a>            pvalues <span class="op">=</span> model.pvalues[<span class="dv">1</span>:]  <span class="co"># Exclude intercept</span></span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a>            worst_pvalue <span class="op">=</span> pvalues.<span class="bu">max</span>()</span>
<span id="cb20-110"><a href="#cb20-110" aria-hidden="true" tabindex="-1"></a>            worst_feature <span class="op">=</span> pvalues.idxmax()</span>
<span id="cb20-111"><a href="#cb20-111" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-112"><a href="#cb20-112" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> worst_pvalue <span class="op">&gt;</span> threshold_out:</span>
<span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a>                included.remove(worst_feature)</span>
<span id="cb20-114"><a href="#cb20-114" aria-hidden="true" tabindex="-1"></a>                excluded.append(worst_feature)</span>
<span id="cb20-115"><a href="#cb20-115" aria-hidden="true" tabindex="-1"></a>                changed <span class="op">=</span> <span class="va">True</span></span>
<span id="cb20-116"><a href="#cb20-116" aria-hidden="true" tabindex="-1"></a>                step <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb20-117"><a href="#cb20-117" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb20-118"><a href="#cb20-118" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Refit without removed variable</span></span>
<span id="cb20-119"><a href="#cb20-119" aria-hidden="true" tabindex="-1"></a>                X_subset_new <span class="op">=</span> X[included]</span>
<span id="cb20-120"><a href="#cb20-120" aria-hidden="true" tabindex="-1"></a>                X_with_const_new <span class="op">=</span> sm.add_constant(X_subset_new, has_constant<span class="op">=</span><span class="st">'add'</span>)</span>
<span id="cb20-121"><a href="#cb20-121" aria-hidden="true" tabindex="-1"></a>                model_new <span class="op">=</span> sm.OLS(y, X_with_const_new).fit()</span>
<span id="cb20-122"><a href="#cb20-122" aria-hidden="true" tabindex="-1"></a>                best_aic <span class="op">=</span> model_new.aic</span>
<span id="cb20-123"><a href="#cb20-123" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb20-124"><a href="#cb20-124" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> verbose:</span>
<span id="cb20-125"><a href="#cb20-125" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"Step </span><span class="sc">{</span>step<span class="sc">:3d}</span><span class="ss"> - REMOVED '</span><span class="sc">{</span>worst_feature<span class="sc">:25s}</span><span class="ss">' (p=</span><span class="sc">{</span>worst_pvalue<span class="sc">:.4f}</span><span class="ss">, AIC=</span><span class="sc">{</span>best_aic<span class="sc">:.1f}</span><span class="ss">)"</span>)</span>
<span id="cb20-126"><a href="#cb20-126" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-127"><a href="#cb20-127" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> changed:</span>
<span id="cb20-128"><a href="#cb20-128" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb20-129"><a href="#cb20-129" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-130"><a href="#cb20-130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose:</span>
<span id="cb20-131"><a href="#cb20-131" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb20-132"><a href="#cb20-132" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Final model includes </span><span class="sc">{</span><span class="bu">len</span>(included)<span class="sc">}</span><span class="ss"> variables"</span>)</span>
<span id="cb20-133"><a href="#cb20-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-134"><a href="#cb20-134" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> included</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code to Select Media Transform
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="cell-100" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> select_best_transformed_media_features(features, media_features, y, media_names, base_features):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Select best transformed media features based on p-values</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    selected_media <span class="op">=</span> []</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    total_features <span class="op">=</span> features.copy()</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    total_features[media_features.columns] <span class="op">=</span> media_features</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> media_name <span class="kw">in</span> media_names:</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        best_tvalue <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        best_transform <span class="op">=</span> <span class="st">""</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> transform <span class="kw">in</span> media_features.columns:</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> media_name <span class="kw">in</span> transform:</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>            X_subset <span class="op">=</span> total_features[[transform] <span class="op">+</span> base_features]</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>            X_with_const <span class="op">=</span> sm.add_constant(X_subset, has_constant<span class="op">=</span><span class="st">'add'</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                model <span class="op">=</span> sm.OLS(y, X_with_const).fit()</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>                t_value <span class="op">=</span> model.tvalues[transform]</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> t_value <span class="op">&gt;</span> best_tvalue:</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>                    best_tvalue <span class="op">=</span> t_value</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>                    best_transform <span class="op">=</span> transform</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span>:</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> best_transform <span class="op">==</span> <span class="st">""</span>:</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>                    best_transform <span class="op">=</span> transform</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>        selected_media.append(best_transform)</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> selected_media</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p><strong>Select Base Variables</strong></p>
<div id="tbl-base-model-selected-features" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-base-model-selected-features-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Base model selected features using stepwise selection. The model looks reasonable, but includes some variables that will produce biased estimates.
</figcaption>
<div aria-describedby="tbl-base-model-selected-features-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-stdout">
<pre><code>
Starting stepwise selection...
Total candidate variables: 23
--------------------------------------------------------------------------------
Step   1 - ADDED 'holidays                 ' (p=0.0000, AIC=-386.9)
Step   2 - ADDED 'purchase_intent          ' (p=0.0000, AIC=-692.8)
Step   3 - ADDED 'stock_index              ' (p=0.0000, AIC=-904.5)
Step   4 - ADDED 'precipitation            ' (p=0.0000, AIC=-1048.8)
Step   5 - ADDED 'competitor_promos        ' (p=0.0000, AIC=-1185.2)
Step   6 - ADDED 'consumer_confidence      ' (p=0.0000, AIC=-1334.3)
Step   7 - ADDED 'log_distribution_index   ' (p=0.0000, AIC=-1499.1)
Step   8 - REMOVED 'stock_index              ' (p=0.4308, AIC=-1500.5)
Step   9 - ADDED 'temperature              ' (p=0.0000, AIC=-1519.1)
Step  10 - ADDED 'intent_change            ' (p=0.0158, AIC=-1523.1)
Step  11 - ADDED 'brand_awareness          ' (p=0.0164, AIC=-1527.0)
--------------------------------------------------------------------------------
Final model includes 9 variables

================================================================================
FREQUENTIST SELECTED BASE MODEL
================================================================================

 Base Model Fit: R2 = 0.980 DW = 1.501

Selected Variables by Type:
              Variable                Type  Coefficient  Std Error P-value    VIF
              holidays          Confounder     0.355744   0.005805   &lt;0.01   1.67
       purchase_intent            MEDIATOR     2.455619   0.053301   &lt;0.01 102.03
         precipitation         RED HERRING    -0.027437   0.003015   &lt;0.01  22.07
     competitor_promos          Confounder    -0.204070   0.011011   &lt;0.01   5.48
   consumer_confidence          Confounder     0.007367   0.000338   &lt;0.01 161.88
log_distribution_index Derived/Interaction     0.257806   0.006050   &lt;0.01   8.27
           temperature         RED HERRING     0.000785   0.000172   &lt;0.01  43.61
         intent_change            MEDIATOR    -0.100636   0.037900   &lt;0.01   1.82
       brand_awareness            COLLIDER     0.000702   0.000291   0.016  32.50</code></pre>
</div>
</div>
</figure>
</div>
<p>The base variables look reasonable there are no variables that can’t be justified even <code>intent_change</code> being negative could be interpreted as meaningful. Now that the base is mostly set it is time to add some media variables.</p>
<div id="tbl-media-selection-1st" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-media-selection-1st-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Media Selection: 1st Pass Promising Results
</figcaption>
<div aria-describedby="tbl-media-selection-1st-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-stdout">
<pre><code>
 Base Model Fit: R2 = 0.983 DW = 1.477

Selected Variables by Type:
              Variable                Type  Coefficient  Std Error P-value    VIF
              holidays          Confounder     0.316224   0.008403   &lt;0.01   3.95
       purchase_intent            MEDIATOR     2.230874   0.059442   &lt;0.01 156.94
         precipitation         RED HERRING    -0.025306   0.002824   &lt;0.01  22.55
     competitor_promos          Confounder    -0.197373   0.010458   &lt;0.01   5.65
   consumer_confidence          Confounder     0.006896   0.000326   &lt;0.01 194.23
log_distribution_index Derived/Interaction     0.271841   0.006066   &lt;0.01  11.36
           temperature         RED HERRING     0.000844   0.000165   &lt;0.01  48.88
         intent_change            MEDIATOR    -0.072703   0.035560   0.042   1.89
       brand_awareness            COLLIDER     0.000284   0.000277   0.306  34.24
          TV_0.30_1.10               MEDIA     0.154601   0.028456   &lt;0.01  78.08
   Digital_transformed               MEDIA     0.061313   0.010551   &lt;0.01  14.19
      Social_0.30_1.80               MEDIA     0.012201   0.007102   0.087   8.41
       Radio_0.30_1.00               MEDIA     0.041594   0.011881   &lt;0.01  20.55
       Print_0.70_2.00               MEDIA     0.026433   0.013734   0.055   7.94</code></pre>
</div>
</div>
</figure>
</div>
<p>Remove <code>conusmer_confidence</code> because of high VIF (reguardles of wether they are an important control or have a low P-value).</p>
<div id="cell-107" class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
 Base Model Fit: R2 = 0.961 DW = 1.363

Selected Variables by Type:
              Variable                Type  Coefficient  Std Error P-value    VIF
              holidays          Confounder     0.274952   0.014279   &lt;0.01   4.91
       purchase_intent            MEDIATOR     2.271407   0.089305   &lt;0.01 134.09
         precipitation         RED HERRING    -0.021244   0.004244   &lt;0.01  13.94
     competitor_promos          Confounder    -0.223028   0.015643   &lt;0.01   5.70
log_distribution_index Derived/Interaction     0.220188   0.008361   &lt;0.01  11.08
           temperature         RED HERRING     0.000934   0.000249   &lt;0.01  38.55
         intent_change            MEDIATOR    -0.184374   0.053043   &lt;0.01   1.52
       brand_awareness            COLLIDER     0.001045   0.000413   0.012  31.88
          TV_0.40_2.00               MEDIA     0.130986   0.031692   &lt;0.01  21.52
     Digital_0.30_1.30               MEDIA     0.161488   0.020682   &lt;0.01  22.40
      Social_0.80_2.00               MEDIA     0.013254   0.017932   0.460   3.84
       Radio_0.30_1.00               MEDIA     0.038889   0.017930   0.031  20.03
       Print_0.80_2.00               MEDIA     0.060873   0.023353   &lt;0.01   6.75</code></pre>
</div>
</div>
<p>Social’s impact is really small and the p-value is too large perhaps the effect doesn’t act independently of other Digital channels so combine them. Leave them on seperate s-curves because they might still saturate differently. Also <code>purchase_intent</code> VIF is also too high so we will remove that too.</p>
<div id="cell-110" class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
 Base Model Fit: R2 = 0.880 DW = 1.295

Selected Variables by Type:
                                             Variable                Type  Coefficient  Std Error P-value   VIF
                                             holidays          Confounder     0.341947   0.015059   &lt;0.01  1.65
                                        precipitation         RED HERRING    -0.033155   0.007353   &lt;0.01 12.22
                                    competitor_promos          Confounder    -0.256500   0.026846   &lt;0.01  5.53
                               log_distribution_index Derived/Interaction     0.173744   0.014187   &lt;0.01 10.89
                                          temperature         RED HERRING     0.002032   0.000428   &lt;0.01 27.28
                                        intent_change            MEDIATOR     0.693345   0.076326   &lt;0.01  1.21
                                      brand_awareness            COLLIDER     0.002543   0.000705   &lt;0.01 29.09
Social+Digital Social_0.80_1.00 + Digital_transformed Derived/Interaction     0.251795   0.020300   &lt;0.01 16.08
                                    TV_0.30_1.70_lag1               MEDIA     0.138343   0.029999   &lt;0.01 11.68
                                      Radio_0.30_1.00               MEDIA     0.119849   0.030732   &lt;0.01 17.83
                                      Print_0.80_2.00               MEDIA     0.095220   0.040978   0.010  6.53</code></pre>
</div>
</div>
<p>Since the variable Social+Digital were combined we treat Social and Digital as if they both have the same coefficient estimate in the model. This is not standard statistical practice but it makes for contribution and ROI reporting easier.</p>
<div id="tbl-final-model-selection-results" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-final-model-selection-results-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3
</figcaption>
<div aria-describedby="tbl-final-model-selection-results-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-stdout">
<pre><code>
================================================================================
MEDIA EFFECTS: TRUTH vs ESTIMATED
================================================================================

MEDIATOR (purchase_intent) included in model: False

Media Effect Comparison:
--------------------------------------------------------------------------------

TV:
  True TOTAL effect:  0.3200
  True DIRECT effect: 0.0800
  Estimated effect:   0.1383 ± 0.0300
  Comparing to TOTAL effect: Bias = -56.8%
  95% CI: [0.0795, 0.1971]

Digital:
  True TOTAL effect:  0.2800
  True DIRECT effect: 0.0800
  Estimated effect:   0.2518 ± 0.0203
  Comparing to TOTAL effect: Bias = -10.1%
  95% CI: [0.2120, 0.2916]

Social:
  True TOTAL effect:  0.2000
  True DIRECT effect: 0.0400
  Estimated effect:   0.2518 ± 0.0203
  Comparing to TOTAL effect: Bias = +25.9%
  95% CI: [0.2120, 0.2916]

Radio:
  True TOTAL effect:  0.1200
  True DIRECT effect: 0.0400
  Estimated effect:   0.1198 ± 0.0307
  Comparing to TOTAL effect: Bias = -0.1%
  95% CI: [0.0596, 0.1801]

Print:
  True TOTAL effect:  0.0600
  True DIRECT effect: 0.0200
  Estimated effect:   0.0952 ± 0.0410
  Comparing to TOTAL effect: Bias = +58.7%
  95% CI: [0.0149, 0.1755]

================================================================================
PROBLEMATIC SELECTIONS
================================================================================

Variables that bias causal interpretation:
  - precipitation (RED HERRING): coef=-0.0332, p=&lt;0.01
    → No causal effect on sales, reduces precision
  - temperature (RED HERRING): coef=0.0020, p=&lt;0.01
    → No causal effect on sales, reduces precision
  - intent_change (MEDIATOR): coef=0.6933, p=&lt;0.01
    → Blocks indirect media effects, causing underestimation
  - brand_awareness (COLLIDER): coef=0.0025, p=&lt;0.01
    → Creates spurious associations between media and sales

Important sales drivers MISSED: ['distribution_index', 'quality_score', 'word_of_mouth']

CONFOUNDERS MISSED media estimates will be biased: ['seasonality', 'gdp_growth', 'unemployment', 'consumer_confidence', 'product_lifecycle']</code></pre>
</div>
</div>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Best Case Frequentest Model
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div id="tbl-correct-model-specification" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-correct-model-specification-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Model under with the correct adjustment set and media transformation this is if you had perfect knowledge of the data generating process and is the ideal estimator for this data.
</figcaption>
<div aria-describedby="tbl-correct-model-specification-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display">
<table class="simpletable do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>OLS Regression Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>log_sales</td>
<td data-quarto-table-cell-role="th">R-squared:</td>
<td>0.896</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>OLS</td>
<td data-quarto-table-cell-role="th">Adj. R-squared:</td>
<td>0.893</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Method:</td>
<td>Least Squares</td>
<td data-quarto-table-cell-role="th">F-statistic:</td>
<td>251.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Date:</td>
<td>Tue, 27 May 2025</td>
<td data-quarto-table-cell-role="th">Prob (F-statistic):</td>
<td>1.75e-163</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Time:</td>
<td>00:09:32</td>
<td data-quarto-table-cell-role="th">Log-Likelihood:</td>
<td>478.70</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>362</td>
<td data-quarto-table-cell-role="th">AIC:</td>
<td>-931.4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Df Residuals:</td>
<td>349</td>
<td data-quarto-table-cell-role="th">BIC:</td>
<td>-880.8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Df Model:</td>
<td>12</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>nonrobust</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
</tbody>
</table>


<table class="simpletable do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">t</td>
<td data-quarto-table-cell-role="th">P&gt;|t|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">const</td>
<td>6.1410</td>
<td>0.128</td>
<td>48.096</td>
<td>0.000</td>
<td>5.890</td>
<td>6.392</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">seasonality</td>
<td>0.3489</td>
<td>0.020</td>
<td>17.761</td>
<td>0.000</td>
<td>0.310</td>
<td>0.387</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">gdp_growth</td>
<td>-0.1560</td>
<td>0.238</td>
<td>-0.656</td>
<td>0.512</td>
<td>-0.624</td>
<td>0.312</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">unemployment</td>
<td>0.0069</td>
<td>0.003</td>
<td>2.020</td>
<td>0.044</td>
<td>0.000</td>
<td>0.014</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">consumer_confidence</td>
<td>0.0067</td>
<td>0.001</td>
<td>5.906</td>
<td>0.000</td>
<td>0.004</td>
<td>0.009</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">holidays</td>
<td>0.3246</td>
<td>0.022</td>
<td>14.873</td>
<td>0.000</td>
<td>0.282</td>
<td>0.368</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">competitor_promos</td>
<td>-0.2119</td>
<td>0.025</td>
<td>-8.333</td>
<td>0.000</td>
<td>-0.262</td>
<td>-0.162</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">product_lifecycle</td>
<td>-0.7336</td>
<td>0.059</td>
<td>-12.426</td>
<td>0.000</td>
<td>-0.850</td>
<td>-0.618</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">TV_transformed</td>
<td>0.3961</td>
<td>0.079</td>
<td>5.024</td>
<td>0.000</td>
<td>0.241</td>
<td>0.551</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Digital_transformed</td>
<td>0.3162</td>
<td>0.025</td>
<td>12.508</td>
<td>0.000</td>
<td>0.266</td>
<td>0.366</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Social_transformed</td>
<td>0.1903</td>
<td>0.019</td>
<td>10.044</td>
<td>0.000</td>
<td>0.153</td>
<td>0.228</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Radio_transformed</td>
<td>0.1743</td>
<td>0.032</td>
<td>5.471</td>
<td>0.000</td>
<td>0.112</td>
<td>0.237</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Print_transformed</td>
<td>0.0509</td>
<td>0.042</td>
<td>1.200</td>
<td>0.231</td>
<td>-0.033</td>
<td>0.134</td>
</tr>
</tbody>
</table>


<table class="simpletable do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Omnibus:</td>
<td>0.631</td>
<td data-quarto-table-cell-role="th">Durbin-Watson:</td>
<td>1.911</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Prob(Omnibus):</td>
<td>0.730</td>
<td data-quarto-table-cell-role="th">Jarque-Bera (JB):</td>
<td>0.730</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Skew:</td>
<td>-0.018</td>
<td data-quarto-table-cell-role="th">Prob(JB):</td>
<td>0.694</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Kurtosis:</td>
<td>2.783</td>
<td data-quarto-table-cell-role="th">Cond. No.</td>
<td>6.49e+03</td>
</tr>
</tbody>
</table>
<br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br>[2] The condition number is large, 6.49e+03. This might indicate that there are<br>strong multicollinearity or other numerical problems.
</div>
</div>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">Current Methodology</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Ideal Model</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div id="cell-fig-media-transforms-from-selection" class="cell">
<div class="cell-output cell-output-display">
<div id="fig-media-transforms-from-selection" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-media-transforms-from-selection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02_the_illusion_of_significance_files/figure-html/fig-media-transforms-from-selection-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-media-transforms-from-selection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Media transformations selected by stepwise selection. The model is not perfect, but it is a good approximation of the true data generating process.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div id="cell-fig-ideal-model" class="cell">
<div class="cell-output cell-output-display">
<div id="fig-ideal-model" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ideal-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02_the_illusion_of_significance_files/figure-html/fig-ideal-model-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ideal-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Media contributions estimated from the ideal model. This is the ideal estimator for this data.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<ul>
<li><strong>2.2 The Illusion of Precision</strong>
<ul>
<li>Final model results and “significant” findings</li>
<li>Narrow confidence intervals and impressive p-values</li>
<li>ROI rankings and attribution claims</li>
</ul></li>
<li><strong>2.3 The Recommended Strategy</strong>
<ul>
<li>Budget reallocation based on point estimates</li>
<li>Projected lift and business case</li>
</ul></li>
</ul>
</section>
<section id="approach-b-bayesian-causal-reasoning" class="level4">
<h4 class="anchored" data-anchor-id="approach-b-bayesian-causal-reasoning">3. Approach B: Bayesian Causal Reasoning</h4>
<ul>
<li><strong>3.1 Mapping the Causal Landscape</strong>
<ul>
<li>Eliciting stakeholder beliefs and concerns</li>
<li>Constructing multiple plausible DAGs</li>
<li>Identifying testable implications</li>
</ul></li>
<li><strong>3.2 Principled Variable Selection</strong>
<ul>
<li>Spike-and-slab priors for uncertain relationships</li>
<li>Posterior inclusion probabilities vs.&nbsp;p-values</li>
<li>Handling confounders, mediators, and colliders</li>
</ul></li>
<li><strong>3.3 Embracing Model Uncertainty</strong>
<ul>
<li>Bayesian Model Averaging across DAGs</li>
<li>Posterior distributions of causal effects</li>
<li>Sensitivity analysis to untestable assumptions</li>
</ul></li>
</ul>
</section>
<section id="from-uncertainty-to-decisions" class="level4">
<h4 class="anchored" data-anchor-id="from-uncertainty-to-decisions">4. From Uncertainty to Decisions</h4>
<ul>
<li><strong>4.1 Decision Theory Meets Marketing</strong>
<ul>
<li>Utility functions and business objectives</li>
<li>Expected value vs.&nbsp;robust optimization</li>
<li>Portfolio theory for marketing mix</li>
</ul></li>
<li><strong>4.2 The Uncertainty-Aware Strategy</strong>
<ul>
<li>Allocation recommendations with credible intervals</li>
<li>Hedging across model uncertainty</li>
<li>Value of information analysis</li>
</ul></li>
</ul>
</section>
<section id="the-moment-of-truth-comparing-outcomes" class="level4">
<h4 class="anchored" data-anchor-id="the-moment-of-truth-comparing-outcomes">5. The Moment of Truth: Comparing Outcomes</h4>
<ul>
<li><strong>5.1 Revealed Reality</strong>
<ul>
<li>The true data generating process exposed</li>
<li>How each approach performed against truth</li>
</ul></li>
<li><strong>5.2 Financial Impact</strong>
<ul>
<li>ROI achieved by each strategy</li>
<li>Cost of false certainty quantified</li>
</ul></li>
<li><strong>5.3 Robustness Analysis</strong>
<ul>
<li>Performance across alternative scenarios</li>
<li>When each approach fails catastrophically</li>
</ul></li>
</ul>
</section>
<section id="lessons-for-practice" class="level4">
<h4 class="anchored" data-anchor-id="lessons-for-practice">6. Lessons for Practice</h4>
<ul>
<li><strong>6.1 Why the Frequentist Approach Failed</strong>
<ul>
<li>Specific mechanisms of failure</li>
<li>Warning signs that were ignored</li>
</ul></li>
<li><strong>6.2 Why the Bayesian Approach (Mostly) Succeeded</strong>
<ul>
<li>How uncertainty quantification prevented disasters</li>
<li>Where even good methods struggle</li>
</ul></li>
<li><strong>6.3 Implementation Roadmap</strong>
<ul>
<li>Practical steps for organizations</li>
<li>Common obstacles and solutions</li>
<li>Building institutional knowledge</li>
</ul></li>
</ul>
</section>
<section id="beyond-the-case-study-implications-for-mmm" class="level4">
<h4 class="anchored" data-anchor-id="beyond-the-case-study-implications-for-mmm">7. Beyond the Case Study: Implications for MMM</h4>
<ul>
<li>The scalability question</li>
<li>Computational and expertise requirements</li>
<li>The organizational change challenge</li>
<li>A new standard for marketing analytics</li>
</ul>
</section>
</section>
</section>
<section id="consequences-of-flawed-selection-in-mmm" class="level2">
<h2 class="anchored" data-anchor-id="consequences-of-flawed-selection-in-mmm">Consequences of Flawed Selection in MMM</h2>
<p>Employing naive selection methods and subsequent inference leads to significant practical problems:</p>
<ul>
<li><p><strong>Misattribution of ROI &amp; Effects:</strong> Biased estimates for marketing coefficients (ROI) and potentially inaccurate representations of media dynamics (adstock, saturation).</p></li>
<li><p><strong>Flawed Budget Allocation:</strong> Suboptimal marketing investment decisions stemming from unreliable ROI figures.</p></li>
<li><p><strong>Poor Understanding of Business Drivers:</strong> Incorrect identification of baseline factors (trends, seasonality, macroeconomics) and media response patterns.</p></li>
<li><p><strong>Model Instability &amp; Non-Reproducibility:</strong> Selected factors and transformations may vary considerably with data updates, reducing model credibility.</p></li>
<li><p><strong>Overfitting:</strong> Models capture noise specific to the historical data, resulting in poor predictive performance for forecasting or simulations.</p></li>
<li><p><strong>Misinterpretation of Control Factor Coefficients:</strong> Attributing causal effects to the coefficients of baseline or control factors (e.g., macroeconomic variables, competitor activity) included in the model. These factors are typically observational and likely confounded themselves; their coefficients primarily reflect statistical association and adjustment needed to isolate media effects, not necessarily isolated causal impacts. This misinterpretation is related to the “Table 2 fallacy,” where coefficients from a multivariable model are improperly treated as independent causal effects.</p></li>
</ul>
</section>
<section id="recommended-approaches-and-considerations" class="level2">
<h2 class="anchored" data-anchor-id="recommended-approaches-and-considerations">Recommended Approaches and Considerations</h2>
<p>Addressing these challenges requires more robust methodologies:</p>
<ul>
<li><p><strong>Rigorous Time-Series Handling:</strong> Explicitly model or remove seasonality (e.g., dummies, Fourier terms, decomposition); test for and address non-stationarity (e.g., differencing); incorporate theoretically sound lags for media (adstock) and potentially external variables.</p></li>
<li><p><strong>Regularization Methods (LASSO, Ridge, Elastic Net):</strong> Handle many predictors simultaneously, perform coefficient shrinkage and implicit variable selection, often yielding more stable results than stepwise methods. Must be applied in conjunction with appropriate time-series structures.</p></li>
<li><p><strong>Information Criteria (AIC, BIC):</strong> Use for comparing non-nested models that correctly account for time-series properties, providing a more principled approach than p-value thresholds alone.</p></li>
<li><p><strong>Time-Series Cross-Validation:</strong> Employ methods like rolling-origin validation to assess out-of-sample predictive performance robustly.</p></li>
<li><p><strong>Bayesian Frameworks:</strong> Offer a probabilistic approach to uncertainty.</p>
<ul>
<li><p><em>Priors on Functional Forms:</em> Incorporate prior knowledge or average over plausible media transformations (adstock/saturation) instead of hard selection.</p></li>
<li><p><em>Sparsity-Inducing Priors (e.g., Regularized Horseshoe):</em> Provide principled variable selection for external factors by shrinking irrelevant coefficients while retaining influential ones, directly modeling inclusion uncertainty.</p></li>
</ul></li>
<li><p><strong>Causal Inference Techniques:</strong> Explore advanced time-series methods if the primary goal is establishing causal links (use with caution).</p></li>
<li><p><strong>Domain Knowledge &amp; Theory:</strong> Prioritize pre-selecting candidate factors and transformation ranges based on business logic, economic theory, and prior research. Validate final model components for plausibility and stability.</p></li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Improper Use of Domain Knowledge
</div>
</div>
<div class="callout-body-container callout-body">
<p>Exogenous factors in MMM are frequently confounded with media variables or other unobserved drivers. Consequently, the estimated coefficient for an exogenous variable may not represent its direct causal impact on the outcome but rather the statistical adjustment necessary to deconfound the estimated media effects. Rejecting such a variable because its coefficient sign contradicts simple causal expectations might inadvertently remove a necessary control variable, potentially leading to more biased estimates of media effectiveness.</p>
</div>
</div>
<p>Adopting these more rigorous approaches is fundamental to developing media mix models that are statistically sound, reliable, and strategically valuable.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{reda,
  author = {Reda, Matthew},
  title = {The {Illusion} of {Significance}},
  url = {https://redam94.github.io/common_regression_issues/the_illusion_of_significance.html},
  langid = {en},
  abstract = {Statistical models drive millions in spending decisions,
    yet beneath their precise-looking numbers lurks a dangerous problem.
    This post examines how the practice of selecting variables based on
    p-values creates a statistical house of cards; especially in
    Marketing Mix Modeling (MMM) and budget optimization. I show why
    common techniques like stepwise regression inevitably produce
    overconfident models with biased estimates that violate the very
    statistical principles they claim to uphold. These methodological
    flaws can result in money flowing to the wrong marketing channels
    based on **illusory** performance metrics. I demonstrate why
    Bayesian approaches offer a more honest alternative by naturally
    tempering overconfidence, incorporating what we already know, and
    providing intuitive uncertainty measures. Through techniques like
    spike-and-slab priors (or regularized horseshoe priors) and Bayesian
    Model Averaging (BMA), analysts can move beyond arbitrary
    significance thresholds toward probability-based decision-making.
    While Bayesian methods do require more computational horsepower and
    thoughtful prior specification, modern software has made them
    increasingly accessible. Using simulated examples inspired by
    real-world marketing and economic modeling, I show how Bayesian
    methods produce more reliable insights that lead to smarter budget
    allocation decisions.}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-reda" class="csl-entry quarto-appendix-citeas" role="listitem">
Reda, Matthew. n.d. <span>“The Illusion of Significance.”</span> <a href="https://redam94.github.io/common_regression_issues/the_illusion_of_significance.html">https://redam94.github.io/common_regression_issues/the_illusion_of_significance.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/redam94\.github\.io\/common_regression_issues");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/redam94/common_regression_issues/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>